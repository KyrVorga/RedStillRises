import{p as e,g as t,P as i}from"./phaser-ZzDTllDV.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class s extends e.Scene{constructor(){super("Boot")}preload(){this.load.image("mining","assets/mining.png")}create(){this.input.mouse.disableContextMenu(),this.input.on("pointerdown",(function(e){e.rightButtonDown()&&e.event.preventDefault()})),this.scene.start("Preloader")}}const a={alice:{name:"Alice O'Cryssos",folder:"alice",side:"left"},kira:{name:"Kira cu Baro",folder:"kira",side:"right"},unknown:{name:"???",folder:"daniel",side:"left"}},n=[{character:"alice",expression:"happy",text:"Alice approaches the player with a warm smile, her eyes lighting up as she speaks.",style:"Italic"},{character:"alice",expression:"nervous",text:"Hey... you did it! I mean, of course you did.",style:"Normal"},{character:"alice",expression:"happy",text:"Congratulations on winning the laurel! I knew you would.",style:"Normal"},{character:"alice",expression:"worried",text:"Her smile falters slightly, and she glances around nervously.",style:"Italic"},{character:"alice",expression:"worried",text:"It must have been so hard, all that effort... I can’t even imagine.",style:"Normal"},{character:"alice",expression:"happy",text:"But you did it. You really did. You should be proud.",style:"Normal"},{character:"alice",expression:"happy",text:"Everyone’s waiting down in the township for the festivities.",style:"Normal"},{character:"alice",expression:"nervous",text:"Alice fidgets with her hands, her voice softening.",style:"Italic"},{character:"alice",expression:"nervous",text:"It’s going to be wonderful... we should, um, go down together.",style:"Normal"},{character:"system",expression:"",text:"You celebrate with Alice and company into the late hours of the night.",style:"Italic"},{character:"kira",expression:"neutral",text:"The Mine Magistrate, Kira cu Baro, descends into the township, his expression a mask of righteous solemnity as he surveys the crowd.",style:"Italic"},{character:"kira",expression:"neutral",text:"Ah, what a splendid day of triumph... of honor... of integrity... of virtue.",style:"Normal"},{character:"kira",expression:"happy",text:"We gather here to extol the virtues of our tireless clans, who labor endlessly to transform this rugged rock into a beacon of prosperity.",style:"Normal"},{character:"kira",expression:"happy",text:"He chuckles darkly, savoring the grandiose irony of his speech.",style:"Italic"},{character:"kira",expression:"neutral",text:"His demeanor shifts as he raises his hand, casting a shadow of forced gravitas over the crowd.",style:"Italic"},{character:"kira",expression:"neutral",text:"And now, the moment of ultimate virtue... the bestowing of the laurel.",style:"Normal"},{character:"kira",expression:"happy",text:"The laurel is conferred upon Gamma, as is befitting of their efforts.",style:"Normal"},{character:"kira",expression:"neutral",text:"The laurel is a symbol of all that is righteous and true, bestowed upon the worthy.",style:"Normal"},{character:"system",expression:"",text:"Your face contorts with anger, your voice rising in disbelief.",style:"Italic"},{character:"player",expression:"",text:"What? No! We were supposed to win!",style:"Normal"},{character:"player",expression:"",text:"This is wrong!",style:"Normal"},{character:"kira",expression:"snarling",text:"Kira’s eyes flash with malice, his voice low and dangerous.",style:"Italic"},{character:"kira",expression:"snarling",text:"You are a cheater, that is why you did not win.",style:"Normal"},{character:"kira",expression:"neutral",text:"No one cheats under my watch and gets away with it.",style:"Normal"},{character:"kira",expression:"neutral",text:"For your crimes, you will be executed.",style:"Normal"},{character:"system",expression:"",text:"The members of gamma present snicker and chuckle under their breath.",style:"Italic"},{character:"alice",expression:"nervous",text:"Alice steps forward, her voice trembling as she speaks out.",style:"Italic"},{character:"alice",expression:"angry",text:"No! They didn’t cheat!",style:"Normal"},{character:"alice",expression:"angry",text:"This is a mistake—",style:"Normal"},{character:"kira",expression:"neutral",text:"Kira cuts her off sharply, his tone laced with menace.",style:"Italic"},{character:"kira",expression:"neutral",text:"Silence, girl.",style:"Normal"},{character:"kira",expression:"snarling",text:"Speak out of turn again, and you’ll join them in execution.",style:"Normal"},{character:"system",expression:"neutral",text:"The grays, begin moving toward the player, their expressions grim.",style:"Italic"},{character:"kira",expression:"neutral",text:"His voice is cold, devoid of any emotion.",style:"Italic"},{character:"kira",expression:"snarling",text:"You are sentenced to be thrown into the Den, to be devoured by the pit vipers.",style:"Normal"},{character:"kira",expression:"sad",text:"Oh how unfortunate that the best among us must be blinded by their greed.",style:"Normal"},{character:"system",expression:"",text:"You are knocked out and dragged from the township.",style:"Italic"},{character:"system",expression:"",text:"You feel groggy and disoriented. You catch snippets of a conversation as you're dragged away.",style:"Italic"},{character:"gray1",expression:"neutral",text:"The first gray’s voice is low, filled with unease.",style:"Italic"},{character:"gray1",expression:"neutral",text:"Something feels... off about this.",style:"Normal"},{character:"gray1",expression:"neutral",text:"Are we sure they cheated?",style:"Normal"},{character:"gray2",expression:"neutral",text:"The second gray grumbles, his patience wearing thin.",style:"Italic"},{character:"gray2",expression:"neutral",text:"Just throw the body in quick and get out.",style:"Normal"},{character:"gray2",expression:"neutral",text:"No questions.",style:"Normal"},{character:"unknown",expression:"serious",text:"You hear an unknown voice, as you are awoken by a red man.",style:"Italic"},{character:"unknown",expression:"serious",text:"Hey, wake up!",style:"Normal"},{character:"unknown",expression:"serious",text:"You’re safe, for now.",style:"Normal"},{character:"unknown",expression:"serious",text:"We’ve got to move before they come back.",style:"Normal"},{character:"player",expression:"",text:"Still groggy, you try to sit up, confusion clouding your sense.",style:"Italic"},{character:"player",expression:"",text:"I... I need to go back.",style:"Normal"},{character:"player",expression:"",text:"Alice... she’ll be worried...",style:"Normal"},{character:"unknown",expression:"pity",text:"The unknown man frowns, a hint of sadness in his eyes as he delivers a harsh truth.",style:"Italic"},{character:"unknown",expression:"pity",text:"You can’t go back.",style:"Normal"},{character:"unknown",expression:"pity",text:"You’re dead. They think you died in the pit.",style:"Normal"},{character:"unknown",expression:"pity",text:"If you return, they’ll just execute you again.",style:"Normal"},{character:"player",expression:"",text:"You begin to tear up, the weight of your situation sinking in.",style:"Italic"},{character:"unknown",expression:"serious",text:"The unknown man sighs, placing a hand on your shoulder in a gesture of comfort.",style:"Italic"},{character:"unknown",expression:"serious",text:"I know it’s hard, but we’ve got to go.",style:"Normal"},{character:"unknown",expression:"serious",text:"The grays will come back to check the pit, and if they find you missing...",style:"Normal"}];class o extends e.Scene{constructor(){super("Laurel"),this.currentDialogueIndex=0}preload(){this.load.image("alice_angry","assets/alice/angry.png"),this.load.image("alice_happy","assets/alice/happy.png"),this.load.image("alice_neutral","assets/alice/neutral.png"),this.load.image("alice_sad","assets/alice/sad.png"),this.load.image("alice_worried","assets/alice/worried.png"),this.load.image("alice_nervous","assets/alice/nervous.png"),this.load.image("kira_happy","assets/magistrate/happy.png"),this.load.image("kira_neutral","assets/magistrate/neutral.png"),this.load.image("kira_sad","assets/magistrate/sad.png"),this.load.image("kira_snarling","assets/magistrate/snarling.png"),this.load.image("daniel_happy","assets/daniel/happy.png"),this.load.image("daniel_neutral","assets/daniel/neutral.png"),this.load.image("daniel_pity","assets/daniel/pity.png"),this.load.image("daniel_sad","assets/daniel/sad.png"),this.load.image("daniel_serious","assets/daniel/serious.png")}create(){this.cameras.main.setBackgroundColor(0),this.add.image(512,384,"mining").setAlpha(.5),this.dialogueText=this.add.text(512,668,"",{fontFamily:"Arial",fontSize:24,color:"#ffffff",align:"center",wordWrap:{width:512}}).setOrigin(.5).setDepth(1),this.characterImages={},this.input.on("pointerdown",this.nextDialogue,this),this.loadDialogueIndex(),this.showCurrentDialogue()}loadDialogueIndex(){const e=localStorage.getItem("currentDialogueIndex");null!==e&&(this.currentDialogueIndex=parseInt(e,10))}saveDialogueIndex(){localStorage.setItem("currentDialogueIndex",this.currentDialogueIndex)}showCurrentDialogue(){if(this.currentDialogueIndex>=n.length)return;const e=n[this.currentDialogueIndex],t=a[e.character];for(const a in this.characterImages)this.characterImages[a]&&this.characterImages[a].setVisible(!1);const i=["system","player","gray1","gray2"];if(e.expression&&!i.includes(e.character)){const i=`${t.folder}_${e.expression}`;let s=200;"right"===t.side&&(s=824),this.characterImages[e.character]?(this.characterImages[e.character].setTexture(i),this.characterImages[e.character].setPosition(s,600)):this.characterImages[e.character]=this.add.image(s,600,i),this.characterImages[e.character].setVisible(!0)}let s="Normal";e.style&&(s=e.style);const o={fontFamily:"Arial",fontSize:24,color:"#ffffff",align:"center",wordWrap:{width:512},fontStyle:s.toLowerCase()};this.dialogueText.setStyle(o);let r="";r="player"===e.character?`You: ${e.text}`:"system"===e.character?e.text:"gray1"===e.character?`Gray 1: ${e.text}`:"gray2"===e.character?`Gray 2: ${e.text}`:`${t.name}: ${e.text}`,this.dialogueText.setText(r),i.includes(e.character)?(this.dialogueText.setX(512),this.dialogueText.setOrigin(.5)):"left"===t.side?(this.dialogueText.setX(412),this.dialogueText.setOrigin(0,.5)):"right"===t.side&&(this.dialogueText.setX(612),this.dialogueText.setOrigin(1,.5))}nextDialogue(){this.currentDialogueIndex++,this.currentDialogueIndex<n.length?(this.saveDialogueIndex(),this.showCurrentDialogue()):(localStorage.removeItem("currentDialogueIndex"),localStorage.setItem("currentScene","Carving"),this.scene.start("Carving"))}}var r,l={exports:{}};r=l,function(){function e(e,t,i){return e.call.apply(e.bind,arguments)}function t(e,t,i){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function i(s,a,n){return(i=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?e:t).apply(null,arguments)}var s=Date.now||function(){return+new Date};function a(e,t){this.a=e,this.o=t||e,this.c=this.o.document}var n=!!window.FontFace;function o(e,t,i,s){if(t=e.c.createElement(t),i)for(var a in i)i.hasOwnProperty(a)&&("style"==a?t.style.cssText=i[a]:t.setAttribute(a,i[a]));return s&&t.appendChild(e.c.createTextNode(s)),t}function l(e,t,i){(e=e.c.getElementsByTagName(t)[0])||(e=document.documentElement),e.insertBefore(i,e.lastChild)}function h(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t,i){t=t||[],i=i||[];for(var s=e.className.split(/\s+/),a=0;a<t.length;a+=1){for(var n=!1,o=0;o<s.length;o+=1)if(t[a]===s[o]){n=!0;break}n||s.push(t[a])}for(t=[],a=0;a<s.length;a+=1){for(n=!1,o=0;o<i.length;o+=1)if(s[a]===i[o]){n=!0;break}n||t.push(s[a])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function u(e,t){for(var i=e.className.split(/\s+/),s=0,a=i.length;s<a;s++)if(i[s]==t)return!0;return!1}function d(e,t,i){function s(){c&&a&&r&&(c(h),c=null)}t=o(e,"link",{rel:"stylesheet",href:t,media:"all"});var a=!1,r=!0,h=null,c=i||null;n?(t.onload=function(){a=!0,s()},t.onerror=function(){a=!0,h=Error("Stylesheet failed to load"),s()}):setTimeout((function(){a=!0,s()}),0),l(e,"head",t)}function g(e,t,i,s){var a=e.c.getElementsByTagName("head")[0];if(a){var n=o(e,"script",{src:t}),r=!1;return n.onload=n.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),n.onload=n.onreadystatechange=null,"HEAD"==n.parentNode.tagName&&a.removeChild(n))},a.appendChild(n),setTimeout((function(){r||(r=!0,i&&i(Error("Script load timeout")))}),s||5e3),n}return null}function m(){this.a=0,this.c=null}function p(e){return e.a++,function(){e.a--,y(e)}}function f(e,t){e.c=t,y(e)}function y(e){0==e.a&&e.c&&(e.c(),e.c=null)}function v(e){this.a=e||"-"}function w(e,t){this.c=e,this.f=4,this.a="n";var i=(t||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function x(e){var t=[];e=e.split(/,\s*/);for(var i=0;i<e.length;i++){var s=e[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?t.push("'"+s+"'"):t.push(s)}return t.join(",")}function b(e){return e.a+e.f}function S(e){var t="normal";return"o"===e.a?t="oblique":"i"===e.a&&(t="italic"),t}function M(e){var t=4,i="n",s=null;return e&&((s=e.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=e.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?t=7:/[1-9]00/.test(s[1])&&(t=parseInt(s[1].substr(0,1),10)))),i+t}function T(e,t){this.c=e,this.f=e.o.document.documentElement,this.h=t,this.a=new v("-"),this.j=!1!==t.events,this.g=!1!==t.classes}function k(e){if(e.g){var t=u(e.f,e.a.c("wf","active")),i=[],s=[e.a.c("wf","loading")];t||i.push(e.a.c("wf","inactive")),c(e.f,i,s)}_(e,"inactive")}function _(e,t,i){e.j&&e.h[t]&&(i?e.h[t](i.c,b(i)):e.h[t]())}function C(){this.c={}}function I(e,t){this.c=e,this.f=t,this.a=o(this.c,"span",{"aria-hidden":"true"},this.f)}function L(e){l(e.c,"body",e.a)}function D(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+x(e.c)+";font-style:"+S(e)+";font-weight:"+e.f+"00;"}function E(e,t,i,s,a,n){this.g=e,this.j=t,this.a=s,this.c=i,this.f=a||3e3,this.h=n||void 0}function q(e,t,i,s,a,n,o){this.v=e,this.B=t,this.c=i,this.a=s,this.s=o||"BESbswy",this.f={},this.w=a||3e3,this.u=n||null,this.m=this.j=this.h=this.g=null,this.g=new I(this.c,this.s),this.h=new I(this.c,this.s),this.j=new I(this.c,this.s),this.m=new I(this.c,this.s),e=D(e=new w(this.a.c+",serif",b(this.a))),this.g.a.style.cssText=e,e=D(e=new w(this.a.c+",sans-serif",b(this.a))),this.h.a.style.cssText=e,e=D(e=new w("serif",b(this.a))),this.j.a.style.cssText=e,e=D(e=new w("sans-serif",b(this.a))),this.m.a.style.cssText=e,L(this.g),L(this.h),L(this.j),L(this.m)}v.prototype.c=function(e){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.a)},E.prototype.start=function(){var e=this.c.o.document,t=this,i=s(),a=new Promise((function(a,n){!function o(){s()-i>=t.f?n():e.fonts.load(function(e){return S(e)+" "+e.f+"00 300px "+x(e.c)}(t.a),t.h).then((function(e){1<=e.length?a():setTimeout(o,25)}),(function(){n()}))}()})),n=null,o=new Promise((function(e,i){n=setTimeout(i,t.f)}));Promise.race([o,a]).then((function(){n&&(clearTimeout(n),n=null),t.g(t.a)}),(function(){t.j(t.a)}))};var B={D:"serif",C:"sans-serif"},U=null;function A(){if(null===U){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);U=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))}return U}function P(e,t,i){for(var s in B)if(B.hasOwnProperty(s)&&t===e.f[B[s]]&&i===e.f[B[s]])return!0;return!1}function H(e){var t,a=e.g.a.offsetWidth,n=e.h.a.offsetWidth;(t=a===e.f.serif&&n===e.f["sans-serif"])||(t=A()&&P(e,a,n)),t?s()-e.A>=e.w?A()&&P(e,a,n)&&(null===e.u||e.u.hasOwnProperty(e.a.c))?N(e,e.v):N(e,e.B):function(e){setTimeout(i((function(){H(this)}),e),50)}(e):N(e,e.v)}function N(e,t){setTimeout(i((function(){h(this.g.a),h(this.h.a),h(this.j.a),h(this.m.a),t(this.a)}),e),0)}function z(e,t,i){this.c=e,this.a=t,this.f=0,this.m=this.j=!1,this.s=i}q.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=s(),H(this)};var j=null;function O(e){0==--e.f&&e.j&&(e.m?((e=e.a).g&&c(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),_(e,"active")):k(e.a))}function F(e){this.j=e,this.a=new C,this.h=0,this.f=this.g=!0}function W(e,t,s,a,n){var o=0==--e.h;(e.f||e.g)&&setTimeout((function(){var e=n||null,r=a||{};if(0===s.length&&o)k(t.a);else{t.f+=s.length,o&&(t.j=o);var l,h=[];for(l=0;l<s.length;l++){var u=s[l],d=r[u.c],g=t.a,m=u;if(g.g&&c(g.f,[g.a.c("wf",m.c,b(m).toString(),"loading")]),_(g,"fontloading",m),g=null,null===j)if(window.FontFace){m=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var p=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);j=m?42<parseInt(m[1],10):!p}else j=!1;g=j?new E(i(t.g,t),i(t.h,t),t.c,u,t.s,d):new q(i(t.g,t),i(t.h,t),t.c,u,t.s,e,d),h.push(g)}for(l=0;l<h.length;l++)h[l].start()}}),0)}function R(e,t){this.c=e,this.a=t}function Y(e,t){this.c=e,this.a=t}function V(e,t){this.c=e||$,this.a=[],this.f=[],this.g=t||""}z.prototype.g=function(e){var t=this.a;t.g&&c(t.f,[t.a.c("wf",e.c,b(e).toString(),"active")],[t.a.c("wf",e.c,b(e).toString(),"loading"),t.a.c("wf",e.c,b(e).toString(),"inactive")]),_(t,"fontactive",e),this.m=!0,O(this)},z.prototype.h=function(e){var t=this.a;if(t.g){var i=u(t.f,t.a.c("wf",e.c,b(e).toString(),"active")),s=[],a=[t.a.c("wf",e.c,b(e).toString(),"loading")];i||s.push(t.a.c("wf",e.c,b(e).toString(),"inactive")),c(t.f,s,a)}_(t,"fontinactive",e),O(this)},F.prototype.load=function(e){this.c=new a(this.j,e.context||this.j),this.g=!1!==e.events,this.f=!1!==e.classes,function(e,t,i){var s=[],a=i.timeout;!function(e){e.g&&c(e.f,[e.a.c("wf","loading")]),_(e,"loading")}(t),s=function(e,t,i){var s,a=[];for(s in t)if(t.hasOwnProperty(s)){var n=e.c[s];n&&a.push(n(t[s],i))}return a}(e.a,i,e.c);var n=new z(e.c,t,a);for(e.h=s.length,t=0,i=s.length;t<i;t++)s[t].load((function(t,i,s){W(e,n,t,i,s)}))}(this,new T(this.c,e),e)},R.prototype.load=function(e){function t(){if(n["__mti_fntLst"+s]){var i,a=n["__mti_fntLst"+s](),o=[];if(a)for(var r=0;r<a.length;r++){var l=a[r].fontfamily;null!=a[r].fontStyle&&null!=a[r].fontWeight?(i=a[r].fontStyle+a[r].fontWeight,o.push(new w(l,i))):o.push(new w(l))}e(o)}else setTimeout((function(){t()}),50)}var i=this,s=i.a.projectId,a=i.a.version;if(s){var n=i.c.o;g(this.c,(i.a.api||"https://fast.fonts.net/jsapi")+"/"+s+".js"+(a?"?v="+a:""),(function(a){a?e([]):(n["__MonotypeConfiguration__"+s]=function(){return i.a},t())})).id="__MonotypeAPIScript__"+s}else e([])},Y.prototype.load=function(e){var t,i,s=this.a.urls||[],a=this.a.families||[],n=this.a.testStrings||{},o=new m;for(t=0,i=s.length;t<i;t++)d(this.c,s[t],p(o));var r=[];for(t=0,i=a.length;t<i;t++)if((s=a[t].split(":"))[1])for(var l=s[1].split(","),h=0;h<l.length;h+=1)r.push(new w(s[0],l[h]));else r.push(new w(s[0]));f(o,(function(){e(r,n)}))};var $="https://fonts.googleapis.com/css";function Q(e){this.f=e,this.a=[],this.c={}}var G={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},X={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},K={i:"i",italic:"i",n:"n",normal:"n"},J=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Z(e,t){this.c=e,this.a=t}var ee={Arimo:!0,Cousine:!0,Tinos:!0};function te(e,t){this.c=e,this.a=t}function ie(e,t){this.c=e,this.f=t,this.a=[]}Z.prototype.load=function(e){var t=new m,i=this.c,s=new V(this.a.api,this.a.text),a=this.a.families;!function(e,t){for(var i=t.length,s=0;s<i;s++){var a=t[s].split(":");3==a.length&&e.f.push(a.pop());var n="";2==a.length&&""!=a[1]&&(n=":"),e.a.push(a.join(n))}}(s,a);var n=new Q(a);!function(e){for(var t=e.f.length,i=0;i<t;i++){var s=e.f[i].split(":"),a=s[0].replace(/\+/g," "),n=["n4"];if(2<=s.length){var o;if(o=[],r=s[1])for(var r,l=(r=r.split(",")).length,h=0;h<l;h++){var c;if((c=r[h]).match(/^[\w-]+$/))if(null==(u=J.exec(c.toLowerCase())))c="";else{if(c=null==(c=u[2])||""==c?"n":K[c],null==(u=u[1])||""==u)u="4";else var u=X[u]||(isNaN(u)?"4":u.substr(0,1));c=[c,u].join("")}else c="";c&&o.push(c)}0<o.length&&(n=o),3==s.length&&(o=[],0<(s=(s=s[2])?s.split(","):o).length&&(s=G[s[0]])&&(e.c[a]=s))}for(e.c[a]||(s=G[a])&&(e.c[a]=s),s=0;s<n.length;s+=1)e.a.push(new w(a,n[s]))}}(n),d(i,function(e){if(0==e.a.length)throw Error("No fonts to load!");if(-1!=e.c.indexOf("kit="))return e.c;for(var t=e.a.length,i=[],s=0;s<t;s++)i.push(e.a[s].replace(/ /g,"+"));return t=e.c+"?family="+i.join("%7C"),0<e.f.length&&(t+="&subset="+e.f.join(",")),0<e.g.length&&(t+="&text="+encodeURIComponent(e.g)),t}(s),p(t)),f(t,(function(){e(n.a,n.c,ee)}))},te.prototype.load=function(e){var t=this.a.id,i=this.c.o;t?g(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",(function(t){if(t)e([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){t=i.Typekit.config.fn;for(var s=[],a=0;a<t.length;a+=2)for(var n=t[a],o=t[a+1],r=0;r<o.length;r++)s.push(new w(n,o[r]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(l){}e(s)}}),2e3):e([])},ie.prototype.load=function(e){var t=this.f.id,i=this.c.o,s=this;t?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[t]=function(t,i){for(var a=0,n=i.fonts.length;a<n;++a){var o=i.fonts[a];s.a.push(new w(o.name,M("font-weight:"+o.weight+";font-style:"+o.style)))}e(s.a)},g(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(e){return e.o.location.hostname||e.a.location.hostname}(this.c)+"/"+t+".js",(function(t){t&&e([])}))):e([])};var se=new F(window);se.a.c.custom=function(e,t){return new Y(t,e)},se.a.c.fontdeck=function(e,t){return new ie(t,e)},se.a.c.monotype=function(e,t){return new R(t,e)},se.a.c.typekit=function(e,t){return new te(t,e)},se.a.c.google=function(e,t){return new Z(t,e)};var ae={load:i(se.load,se)};r.exports?r.exports=ae:(window.WebFont=ae,window.WebFontConfig&&se.load(window.WebFontConfig))}();const h=t(l.exports);class c extends e.Scene{constructor(){super("MainMenu")}preload(){this.load.script("webfont","https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js")}create(){const e=localStorage.getItem("currentScene");h.load({custom:{families:["Pixelify Sans"],urls:["/style.css"]},active:()=>{this.add.image(512,384,"mining").setAlpha(.5),this.add.image(512,380,"logo"),this.add.text(512,460,"Play",{fontFamily:"Pixelify Sans",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{if(null!==e)switch(e){case"Mining":this.scene.start("Mining");break;case"Laurel":this.scene.start("Laurel");break;case"Carving":this.scene.start("Carving");break;case"CarvingQuestions":this.scene.start("CarvingQuestions");break;case"Institute":this.scene.start("Institute")}else this.scene.start("Mining")}))}})}}class u extends e.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"mining"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("institute","mountain.png"),this.load.image("city","city.png")}create(){this.scene.start("MainMenu")}}class d extends e.Scene{constructor(){super({key:"Mining"}),this.helium=0,this.heliumTarget=1e4,this.isMining=!1,this.progressBarWidth=400,this.progressBarHeight=20,this.isMiningSpeedUpgradeEnabled=!1,this.miningSpeedLevel=1,this.miningSpeedMaxLevel=5,this.miningSpeedCosts={1:3,2:5,3:10,4:25,5:50},this.miningSpeedValues={1:5e3,2:4e3,3:3e3,4:2e3,5:1e3},this.miningSpeedDescription="Decreases mining time by 1 second per level.",this.isHeliumStorageUpgradeEnabled=!1,this.heliumStorageLevel=1,this.heliumStorageMaxLevel=10,this.heliumStorageCosts={1:6,2:10,3:20,4:40,5:75,6:150,7:300,8:600,9:1e3,10:2e3},this.heliumStorageValues={1:10,2:30,3:75,4:150,5:250,6:500,7:1e3,8:2500,9:5e3,10:1e4},this.heliumStorageDescription="Increases the maximum amount of Helium-3 you can store.",this.isMiningEfficiencyUpgradeEnabled=!1,this.miningEfficiencyLevel=1,this.miningEfficiencyMaxLevel=5,this.miningEfficiencyCosts={1:12,2:20,3:80,4:320,5:1280},this.miningEfficiencyValues={1:1,2:2,3:4,4:8,5:16},this.miningEfficiencyDescription="Doubles the amount of Helium-3 mined per level.",this.isAddtionalMinerUpgradeEnabled=!1,this.additionalMinerLevel=1,this.additionalMinerMaxLevel=5,this.additionalMinerCosts={1:70,2:100,3:400,4:1600,5:3200},this.additionalMinerDescription="Adds an additional miner to mine Helium per level.",this.upgradeContainers={},this.upgradeBarContainers={}}preload(){}create(){this.cameras.main.setBackgroundColor(0),this.add.image(512,384,"mining").setAlpha(.5),this.loadProgress(),this.goalText=this.add.text(512,20,"Goal: 10000 Helium-3",{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.heliumText=this.add.text(512,70,"Helium-3: "+this.helium+" / "+this.GetHeliumStorage(),{fontFamily:"Pixelify Sans",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5),this.mineButton=this.add.text(512,150,"Mine",{fontFamily:"Pixelify Sans",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.isMining||this.MineHelium()})),this.progressBarFill=this.add.graphics(),this.isMiningSpeedUpgradeEnabled&&this.DisplayMiningSpeedUpgrade(),this.isHeliumStorageUpgradeEnabled&&this.DisplayHeliumStorageUpgrade(),this.isMiningEfficiencyUpgradeEnabled&&this.DisplayMiningEfficiencyUpgrade(),this.isAddtionalMinerUpgradeEnabled&&this.DisplayAdditionalMinerUpgrade()}update(){}loadProgress(){const e=localStorage.getItem("helium");null!==e&&(this.helium=parseFloat(e),this.helium>=this.heliumTarget&&this.NextScene());const t=localStorage.getItem("isMiningSpeedUpgradeEnabled");null!==t&&(this.isMiningSpeedUpgradeEnabled="true"===t);const i=localStorage.getItem("isHeliumStorageUpgradeEnabled");null!==i&&(this.isHeliumStorageUpgradeEnabled="true"===i);const s=localStorage.getItem("isMiningEfficiencyUpgradeEnabled");null!==s&&(this.isMiningEfficiencyUpgradeEnabled="true"===s);const a=localStorage.getItem("isAddtionalMinerUpgradeEnabled");null!==a&&(this.isAddtionalMinerUpgradeEnabled="true"===a);const n=localStorage.getItem("miningSpeedLevel");null!==n&&(this.miningSpeedLevel=parseInt(n));const o=localStorage.getItem("heliumStorageLevel");null!==o&&(this.heliumStorageLevel=parseInt(o));const r=localStorage.getItem("miningEfficiencyLevel");null!==r&&(this.miningEfficiencyLevel=parseInt(r));const l=localStorage.getItem("additionalMinerLevel");null!==l&&(this.additionalMinerLevel=parseInt(l))}saveProgress(){localStorage.setItem("helium",this.helium),localStorage.setItem("currentScene","Mining"),localStorage.setItem("isMiningSpeedUpgradeEnabled",this.isMiningSpeedUpgradeEnabled),localStorage.setItem("isHeliumStorageUpgradeEnabled",this.isHeliumStorageUpgradeEnabled),localStorage.setItem("isMiningEfficiencyUpgradeEnabled",this.isMiningEfficiencyUpgradeEnabled),localStorage.setItem("isAddtionalMinerUpgradeEnabled",this.isAddtionalMinerUpgradeEnabled),localStorage.setItem("miningSpeedLevel",this.miningSpeedLevel),localStorage.setItem("heliumStorageLevel",this.heliumStorageLevel),localStorage.setItem("miningEfficiencyLevel",this.miningEfficiencyLevel),localStorage.setItem("additionalMinerLevel",this.additionalMinerLevel)}UpdateHeliumText(){this.heliumText.setText("Helium-3: "+this.helium+" / "+this.GetHeliumStorage())}MineHelium(){this.isMining=!0,this.progressBarFill.clear(),this.tweens.addCounter({from:0,to:100,duration:this.CalculateMiningTime(),ease:"Linear",onUpdate:e=>{const t=e.getValue();this.progressBarFill.clear(),this.progressBarFill.fillStyle(16777215,1),this.progressBarFill.fillRect(512-this.progressBarWidth/2,200,this.progressBarWidth*(t/100),this.progressBarHeight)},onComplete:()=>{this.progressBarFill.clear(),this.helium+=this.CalculateMiningReturn();let e=this.GetHeliumStorage();this.helium>e&&(this.helium=e),this.UpdateHeliumText(),this.helium>=this.heliumTarget&&this.NextScene(),this.helium>=this.miningSpeedCosts[1]&&!this.isMiningSpeedUpgradeEnabled&&(this.isMiningSpeedUpgradeEnabled=!0,this.DisplayMiningSpeedUpgrade()),this.helium>=this.heliumStorageCosts[1]&&!this.isHeliumStorageUpgradeEnabled&&(this.isHeliumStorageUpgradeEnabled=!0,this.DisplayHeliumStorageUpgrade()),this.helium>=this.miningEfficiencyCosts[1]&&!this.isMiningEfficiencyUpgradeEnabled&&(this.isMiningEfficiencyUpgradeEnabled=!0,this.DisplayMiningEfficiencyUpgrade()),this.helium>=this.additionalMinerCosts[1]&&!this.isAddtionalMinerUpgradeEnabled&&(this.isAddtionalMinerUpgradeEnabled=!0,this.DisplayAdditionalMinerUpgrade()),this.saveProgress(),this.isMining=!1}})}UpgradeMiningSpeed(){if(this.miningSpeedLevel>=this.miningSpeedMaxLevel)return;let e=this.miningSpeedCosts[this.miningSpeedLevel+1];this.helium>=e&&(this.helium-=e,this.miningSpeedLevel++,this.miningSpeedLevel==this.miningSpeedMaxLevel?(this.upgradeContainers.miningSpeed.destroy(),this.DisplayMiningSpeedUpgrade()):(e=this.miningSpeedCosts[this.miningSpeedLevel+1],this.miningSpeedLevelText.setText("Level: "+this.miningSpeedLevel),this.miningSpeedCostText.setText("Cost: "+e),this.DisplayUpgradeOptions("miningSpeed",this.miningSpeedUpgradeBarX,this.miningSpeedUpgradeBarY,this.miningSpeedLevel,this.miningSpeedMaxLevel,this.UpgradeMiningSpeed.bind(this)))),this.UpdateHeliumText(),this.saveProgress()}UpgradeHeliumStorage(){if(this.heliumStorageLevel>=this.heliumStorageMaxLevel)return;let e=this.heliumStorageCosts[this.heliumStorageLevel+1];this.helium>=e&&(this.helium-=e,this.heliumStorageLevel++,this.heliumStorageLevel==this.heliumStorageMaxLevel?(this.upgradeContainers.heliumStorage.destroy(),this.DisplayHeliumStorageUpgrade()):(e=this.heliumStorageCosts[this.heliumStorageLevel+1],this.heliumStorageLevelText.setText("Level: "+this.heliumStorageLevel),this.heliumStorageCostText.setText("Cost: "+e),this.DisplayUpgradeOptions("heliumStorage",this.heliumStorageUpgradeBarX,this.heliumStorageUpgradeBarY,this.heliumStorageLevel,this.heliumStorageMaxLevel,this.UpgradeHeliumStorage.bind(this)))),this.UpdateHeliumText(),this.saveProgress()}UpgradeMiningEfficiency(){if(this.miningEfficiencyLevel>=this.miningEfficiencyMaxLevel)return;let e=this.miningEfficiencyCosts[this.miningEfficiencyLevel+1];this.helium>=e&&(this.helium-=e,this.miningEfficiencyLevel++,this.miningEfficiencyLevel==this.miningEfficiencyMaxLevel?(this.upgradeContainers.miningEfficiency.destroy(),this.DisplayMiningEfficiencyUpgrade()):(e=this.miningEfficiencyCosts[this.miningEfficiencyLevel+1],this.miningEfficiencyLevelText.setText("Level: "+this.miningEfficiencyLevel),this.miningEfficiencyCostText.setText("Cost: "+e),this.DisplayUpgradeOptions("miningEfficiency",this.miningEfficiencyUpgradeBarX,this.miningEfficiencyUpgradeBarY,this.miningEfficiencyLevel,this.miningEfficiencyMaxLevel,this.UpgradeMiningEfficiency.bind(this)))),this.UpdateHeliumText(),this.saveProgress()}UpgradeAdditionalMiner(){if(this.additionalMinerLevel>=this.additionalMinerMaxLevel)return;let e=this.additionalMinerCosts[this.additionalMinerLevel+1];this.helium>=e&&(this.helium-=e,this.additionalMinerLevel++,this.additionalMinerLevel==this.additionalMinerMaxLevel?(this.upgradeContainers.additionalMiner.destroy(),this.DisplayAdditionalMinerUpgrade()):(e=this.additionalMinerCosts[this.additionalMinerLevel+1],this.additionalMinerLevelText.setText("Level: "+this.additionalMinerLevel),this.additionalMinerCostText.setText("Cost: "+e),this.DisplayUpgradeOptions("additionalMiner",this.additionalMinerUpgradeBarX,this.additionalMinerUpgradeBarY,this.additionalMinerLevel,this.additionalMinerMaxLevel,this.UpgradeAdditionalMiner.bind(this)))),this.UpdateHeliumText(),this.saveProgress()}DisplayUpgradeOptions(e,t,i,s,a,n){this.upgradeBarContainers[e]&&this.upgradeBarContainers[e].destroy();let o=this.add.container(t,i);this.upgradeBarContainers[e]=o;for(let r=0;r<a;r++)if(r<=s-1){let e=this.add.rectangle(15*r+5,5,12,12,16777215);o.add(e)}else{let e=this.add.circle(15*r+5,5,5,12303291);o.add(e)}if(s<a){let e=15*a,t=0,i=this.add.text(e+5,t-6,"+",{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2}).setInteractive().on("pointerdown",(()=>{n()}));o.add(i)}this.upgradeContainers[e].add(o)}DisplayMiningSpeedUpgrade(){this.upgradeContainers.miningSpeed=this.add.container(1024/6,256),this.miningSpeedText=this.add.text(0,0,"Upgrade: Mining Speed",{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningSpeed.add(this.miningSpeedText);let e=this.miningSpeedText.y+this.miningSpeedText.height+10;if(this.miningSpeedDescriptionText=this.add.text(0,e,this.miningSpeedDescription,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningSpeed.add(this.miningSpeedDescriptionText),e=this.miningSpeedDescriptionText.y+this.miningSpeedDescriptionText.height+10,this.miningSpeedLevelText=this.add.text(0,e,"Level: "+this.miningSpeedLevel,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningSpeed.add(this.miningSpeedLevelText),e=this.miningSpeedLevelText.y+this.miningSpeedLevelText.height+10,this.miningSpeedLevel<this.miningSpeedMaxLevel){let t=this.miningSpeedCosts[this.miningSpeedLevel+1];this.miningSpeedCostText=this.add.text(0,e,"Cost: "+t,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningSpeed.add(this.miningSpeedCostText),e=this.miningSpeedCostText.y+this.miningSpeedCostText.height+10}this.miningSpeedUpgradeBarX=4,this.miningSpeedUpgradeBarY=e,this.DisplayUpgradeOptions("miningSpeed",this.miningSpeedUpgradeBarX,this.miningSpeedUpgradeBarY,this.miningSpeedLevel,this.miningSpeedMaxLevel,this.UpgradeMiningSpeed.bind(this))}DisplayHeliumStorageUpgrade(){let e=this.upgradeContainers.miningSpeed.getBounds().bottom+70,t=this.upgradeContainers.miningSpeed.getBounds().left;this.upgradeContainers.heliumStorage=this.add.container(t,e),this.heliumStorageText=this.add.text(0,0,"Upgrade: Helium Storage",{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.heliumStorage.add(this.heliumStorageText);let i=this.heliumStorageText.y+this.heliumStorageText.height+10;if(this.heliumStorageDescriptionText=this.add.text(0,i,this.heliumStorageDescription,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.heliumStorage.add(this.heliumStorageDescriptionText),i=this.heliumStorageDescriptionText.y+this.heliumStorageDescriptionText.height+10,this.heliumStorageLevelText=this.add.text(0,i,"Level: "+this.heliumStorageLevel,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.heliumStorage.add(this.heliumStorageLevelText),i=this.heliumStorageLevelText.y+this.heliumStorageLevelText.height+10,this.heliumStorageLevel<this.heliumStorageMaxLevel){let e=this.heliumStorageCosts[this.heliumStorageLevel+1];this.heliumStorageCostText=this.add.text(0,i,"Cost: "+e,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.heliumStorage.add(this.heliumStorageCostText),i=this.heliumStorageCostText.y+this.heliumStorageCostText.height+10}this.heliumStorageUpgradeBarX=0,this.heliumStorageUpgradeBarY=i,this.DisplayUpgradeOptions("heliumStorage",this.heliumStorageUpgradeBarX,this.heliumStorageUpgradeBarY,this.heliumStorageLevel,this.heliumStorageMaxLevel,this.UpgradeHeliumStorage.bind(this))}DisplayMiningEfficiencyUpgrade(){let e=this.upgradeContainers.miningSpeed.getBounds().top,t=this.upgradeContainers.miningSpeed.getBounds().right+100;this.upgradeContainers.miningEfficiency=this.add.container(t,e),this.miningEfficiencyText=this.add.text(0,0,"Upgrade: Mining efficiency",{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningEfficiency.add(this.miningEfficiencyText);let i=this.miningEfficiencyText.y+this.miningEfficiencyText.height+10;if(this.miningEfficiencyDescriptionText=this.add.text(0,i,this.miningEfficiencyDescription,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningEfficiency.add(this.miningEfficiencyDescriptionText),i=this.miningEfficiencyDescriptionText.y+this.miningEfficiencyDescriptionText.height+10,this.miningEfficiencyLevelText=this.add.text(0,i,"Level: "+this.miningEfficiencyLevel,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningEfficiency.add(this.miningEfficiencyLevelText),i=this.miningEfficiencyLevelText.y+this.miningEfficiencyLevelText.height+10,this.miningEfficiencyLevel<this.miningEfficiencyMaxLevel){let e=this.miningEfficiencyCosts[this.miningEfficiencyLevel+1];this.miningEfficiencyCostText=this.add.text(0,i,"Cost: "+e,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.miningEfficiency.add(this.miningEfficiencyCostText),i=this.miningEfficiencyCostText.y+this.miningEfficiencyCostText.height+10}this.miningEfficiencyUpgradeBarX=0,this.miningEfficiencyUpgradeBarY=i,this.DisplayUpgradeOptions("miningEfficiency",this.miningEfficiencyUpgradeBarX,this.miningEfficiencyUpgradeBarY,this.miningEfficiencyLevel,this.miningEfficiencyMaxLevel,this.UpgradeMiningEfficiency.bind(this))}DisplayAdditionalMinerUpgrade(){let e=this.upgradeContainers.heliumStorage.getBounds().top,t=this.upgradeContainers.miningEfficiency.getBounds().left;this.upgradeContainers.additionalMiner=this.add.container(t,e),this.additionalMinerText=this.add.text(0,0,"Upgrade: Mining Team",{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.additionalMiner.add(this.additionalMinerText);let i=this.additionalMinerText.y+this.additionalMinerText.height+10;if(this.additionalMinerDescriptionText=this.add.text(0,i,this.additionalMinerDescription,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.additionalMiner.add(this.additionalMinerDescriptionText),i=this.additionalMinerDescriptionText.y+this.additionalMinerDescriptionText.height+10,this.additionalMinerLevelText=this.add.text(0,i,"Level: "+this.additionalMinerLevel,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.additionalMiner.add(this.additionalMinerLevelText),i=this.additionalMinerLevelText.y+this.additionalMinerLevelText.height+10,this.additionalMinerLevel<this.additionalMinerMaxLevel){let e=this.additionalMinerCosts[this.additionalMinerLevel+1];this.additionalMinerCostText=this.add.text(0,i,"Cost: "+e,{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:300}}),this.upgradeContainers.additionalMiner.add(this.additionalMinerCostText),i=this.additionalMinerCostText.y+this.additionalMinerCostText.height+10}this.additionalMinerUpgradeBarX=0,this.additionalMinerUpgradeBarY=i,this.DisplayUpgradeOptions("additionalMiner",this.additionalMinerUpgradeBarX,this.additionalMinerUpgradeBarY,this.additionalMinerLevel,this.additionalMinerMaxLevel,this.UpgradeAdditionalMiner.bind(this))}CalculateMiningTime(){return this.miningSpeedValues[this.miningSpeedLevel]}CalculateMiningReturn(){let e=this.miningEfficiencyValues[this.miningEfficiencyLevel];for(let t=1;t<this.additionalMinerLevel;t++)e*=2;return e}GetHeliumStorage(){return this.heliumStorageValues[this.heliumStorageLevel]}NextScene(){localStorage.removeItem("helium"),localStorage.removeItem("isMiningSpeedUpgradeEnabled"),localStorage.removeItem("isHeliumStorageUpgradeEnabled"),localStorage.removeItem("isMiningEfficiencyUpgradeEnabled"),localStorage.removeItem("isAddtionalMinerUpgradeEnabled"),localStorage.removeItem("miningSpeedLevel"),localStorage.removeItem("heliumStorageLevel"),localStorage.removeItem("miningEfficiencyLevel"),localStorage.removeItem("additionalMinerLevel"),localStorage.setItem("currentScene","Laurel"),this.scene.start("Laurel")}}const g=[{id:"q1",text:"You encounter a strange animal trapped in a snare. Its injuries suggest it won’t survive long.",options:[{text:"End its suffering quickly with a decisive action.",values:{mars:3,apollo:2,neptune:1}},{text:"Use your skills to gently help it, even if it may not survive.",values:{ceres:3,minerva:2,venus:1}},{text:"Observe and document the animal to learn from it.",values:{mercury:3,pluto:2,bacchus:1}},{text:"Seek help from others who may be more experienced.",values:{juno:3,jupiter:2,vulcan:1}}]},{id:"q2",text:"Your mentor gives you a choice of tasks.",options:[{text:"Work on crafting something valuable, enhancing your skills.",values:{vulcan:3,apollo:2,pluto:1}},{text:"Gather resources that could benefit others in your group.",values:{ceres:3,juno:2,bacchus:1}},{text:"Perform a task that improves your survival skills.",values:{mars:3,mercury:2,neptune:1}},{text:"Choose the task that aligns with your long-term goals.",values:{jupiter:3,minerva:2,venus:1}}]},{id:"q3",text:"A valuable but outdated tradition in your community is being challenged by younger members advocating for modernization.",options:[{text:"Support the younger members’ push for modernization, believing that change is necessary for progress.",values:{venus:3,jupiter:2,apollo:1}},{text:"Propose a compromise that integrates both traditional and modern elements.",values:{minerva:3,diana:2,neptune:1}},{text:"Defend the tradition strongly, valuing its historical significance and cultural importance.",values:{ceres:3,vulcan:2,pluto:1}},{text:"Remain neutral and observe how the debate unfolds before taking a stance.",values:{juno:3,mercury:2,bacchus:1}}]},{id:"q4",text:"An important event in your community requires volunteers for various roles, but you can only choose one.",options:[{text:"Choose a role that puts you in the spotlight and allows you to showcase your talents.",values:{apollo:3,venus:2,minerva:1}},{text:"Select a behind-the-scenes role that ensures everything runs smoothly without much attention.",values:{minerva:3,ceres:2,vulcan:1}},{text:"Opt for a role that requires significant teamwork and coordination, valuing collaboration.",values:{diana:3,mercury:2,pluto:1}},{text:"Pick a role that offers immediate and tangible benefits to the community.",values:{pluto:3,jupiter:2,neptune:1}}]},{id:"q5",text:"You discover you have a hidden talent that could be valuable but requires dedicated training to develop fully.",options:[{text:"Pursue intensive training to master the talent, believing it will lead to significant personal and professional growth.",values:{mars:3,apollo:2,neptune:1}},{text:"Explore the talent casually, integrating it into your life as a supplementary skill.",values:{bacchus:3,diana:2,venus:1}},{text:"Decide that the talent is interesting but not worth the commitment, focusing on your current strengths.",values:{venus:3,minerva:2,bacchus:1}},{text:"Avoid pursuing the talent, prioritizing existing responsibilities and routines.",values:{juno:3,ceres:2,vulcan:1}}]},{id:"q6",text:"A close friend asks for your help with a risky plan that you both could profit from.",options:[{text:"Agree to the plan, trusting your friend and valuing the potential rewards.",values:{apollo:3,jupiter:2,mercury:1}},{text:"Assess the risks and benefits carefully before making a decision.",values:{mercury:3,ceres:2,pluto:1}},{text:"Decline the offer, preferring to avoid unnecessary risks.",values:{pluto:3,diana:2,neptune:1}},{text:"Negotiate terms and conditions to ensure fairness and safety.",values:{bacchus:3,juno:2,vulcan:1}}]},{id:"q7",text:"You find a long-lost artifact that could reveal important historical insights but might also cause controversy.",options:[{text:"Share the artifact with the public, believing that its historical value outweighs potential controversy.",values:{mars:3,pluto:2,vulcan:1}},{text:"Conduct further research privately to understand its significance before deciding on public disclosure.",values:{neptune:3,juno:2,bacchus:1}},{text:"Keep the artifact hidden to avoid stirring up controversy, prioritizing peace over discovery.",values:{venus:3,neptune:2,apollo:1}},{text:"Consult with experts and stakeholders to gauge their opinions before taking any action.",values:{mercury:3,jupiter:2,vulcan:1}}]},{id:"q8",text:"A friend gives you an embarrassing nickname and mocks you publicly.",options:[{text:"Confront them directly and establish boundaries.",values:{mars:3,apollo:2,neptune:1}},{text:"Turn the situation around by embracing the nickname with humor.",values:{venus:3,pluto:2,mercury:1}},{text:"Create a new, more embarrassing nickname for them in retaliation.",values:{bacchus:3,diana:2,pluto:1}},{text:"Seek to resolve the issue diplomatically and privately.",values:{juno:3,neptune:2,vulcan:1}}]},{id:"q9",text:"There is a heated debate in your community about whether certain resources should be controlled by the elite or made available to everyone.",options:[{text:"Support the control of resources by the elite to ensure their proper use and management.",values:{jupiter:3,apollo:2,bacchus:1}},{text:"Advocate for equal access to resources to benefit the whole community.",values:{ceres:3,vulcan:2,venus:1}},{text:"Seek a balanced approach that includes oversight but allows broader access.",values:{juno:3,diana:2,neptune:1}},{text:"Propose a compromise to involve various stakeholders in decision-making.",values:{mercury:3,minerva:2,pluto:1}}]},{id:"q10",text:"After buying supplies, you receive extra money back by mistake.",options:[{text:"Return the money to the shopkeeper, correcting the error.",values:{jupiter:3,apollo:2,neptune:1}},{text:"Keep the money, considering it a small windfall.",values:{bacchus:3,vulcan:2,mercury:1}},{text:"Donate the money to a cause you care about.",values:{venus:3,minerva:2,ceres:1}},{text:"Use the money for something immediately practical.",values:{diana:3,juno:2,pluto:1}}]},{id:"q11",text:"You witness a thief stealing from a copper. The thief drops the purse near you as he flees.",options:[{text:"Return the purse to the copper, knowing it is the right thing to do.",values:{jupiter:3,mars:2,neptune:1}},{text:"Leave the purse and avoid involvement to stay out of trouble.",values:{minerva:3,ceres:2,bacchus:1}},{text:"Keep the purse, thinking it will help you or your family.",values:{mercury:3,venus:2,apollo:1}},{text:"Hand over the purse to the authorities to handle the situation.",values:{juno:3,diana:2,pluto:1}}]},{id:"q12",text:"You’re assigned a disliked task, and a friend offers to do it for you in exchange for a future favor.",options:[{text:"Decline the offer and complete the task yourself, honoring the expectation.",values:{mars:3,vulcan:2,apollo:1}},{text:"Accept the offer and agree to the favor, valuing efficiency.",values:{diana:3,mercury:2,neptune:1}},{text:"Ask for help, promising to return the favor in the future.",values:{ceres:3,minerva:2,bacchus:1}},{text:"Negotiate terms of the favor to ensure fairness.",values:{juno:3,venus:2,pluto:1}}]},{id:"q13",text:"While you are helping to fix a communal structure, a piece of heavy equipment begins to fall towards a nearby person.",options:[{text:"Move quickly to push the person out of the way and prevent injury.",values:{vulcan:3,mars:2,mercury:1}},{text:"Try to grab and stabilize the equipment to avoid it falling.",values:{jupiter:3,ceres:2,apollo:1}},{text:"Call out for others to assist in managing the situation.",values:{diana:3,minerva:2,neptune:1}},{text:"Ensure the area is cleared and safe to prevent further accidents.",values:{neptune:3,venus:2,pluto:1}}]},{id:"q14",text:"A gang of kids demands money from you, threatening violence.",options:[{text:"Refuse to give them the money and prepare to defend yourself if necessary.",values:{mars:3,vulcan:2,apollo:1}},{text:"Hand over the money to avoid immediate conflict, planning to recover it later.",values:{apollo:3,jupiter:2,mercury:1}},{text:"Try to distract them and make a quick escape with the money.",values:{pluto:3,neptune:2,diana:1}},{text:"Seek help from nearby adults or authorities to handle the situation.",values:{bacchus:3,ceres:2,pluto:1}}]},{id:"q15",text:"A well-dressed man runs from an angry crowd, asking for your help.",options:[{text:"Rush to his aid, despite not knowing the full story.",values:{mars:3,jupiter:2,vulcan:1}},{text:"Stay out of the situation, not wanting to risk involvement.",values:{minerva:3,neptune:2,venus:1}},{text:"Assist him, even if it means facing the crowd.",values:{diana:3,bacchus:2,neptune:1}},{text:"Alert the crowd or authorities to address the situation appropriately.",values:{vulcan:3,bacchus:2,pluto:1}}]},{id:"name",text:"Which of the following golds do you want to become?",options:[{text:"Caelum au Verin"},{text:"Lucian au Solis"},{text:"Selene au Arcturus"},{text:"Leona au Fenix"},{text:"Vesper au Pyxis"},{text:"Helena au Corvin"}]}];class m extends e.Scene{constructor(){super("CarvingQuestions"),this.currentQuestionIndex=null,this.answers={},this.pointerdownListener=null}preload(){}create(){this.cameras.main.setBackgroundColor(0),this.add.image(512,384,"city").setAlpha(.5),this.loadIndices(),this.loadAnswers(),this.startQuestions()}loadIndices(){const e=localStorage.getItem("currentQuestionIndex");null!==e&&(this.currentQuestionIndex=parseInt(e,10)||0)}saveQuestionIndex(){localStorage.setItem("currentQuestionIndex",this.currentQuestionIndex)}saveAnswers(){localStorage.setItem("answers",JSON.stringify(this.answers))}loadAnswers(){const e=localStorage.getItem("answers");null!==e&&(this.answers=JSON.parse(e))}startQuestions(){this.saveQuestionIndex(),this.loadAnswers(),this.questionText&&this.questionText.destroy(),this.optionButtons&&this.optionButtons.forEach((e=>e.destroy())),this.questionText=this.add.text(512,100,"Answer the following questions to determine your house:",{fontFamily:"Pixelify Sans",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center",wordWrap:{width:682.6666666666667}}).setOrigin(.5),this.pointerdownListener=null,this.optionButtons=[],this.optionButtons.push(this.add.text(512,384,"Click to start",{fontFamily:"Pixelify Sans",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",this.showQuestion,this))}showQuestion(){if(null==this.currentQuestionIndex)this.currentQuestionIndex=0;else if(this.currentQuestionIndex>=g.length)return void this.finishQuestions();console.log("Current question index:",this.currentQuestionIndex);const e=g[this.currentQuestionIndex];this.questionText.setText(e.text),this.optionButtons&&this.optionButtons.forEach((e=>e.destroy()));let t=256,i=0;this.optionButtons=e.options.map(((s,a)=>{const n=this.add.text(512,t,s.text,{fontFamily:"Pixelify Sans",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center",wordWrap:{width:682.6666666666667}}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{"name"===e.id?this.answers[e.id]=s.text:this.answers[e.id]=s.values,this.saveAnswers(),this.currentQuestionIndex++,this.saveQuestionIndex(),this.showQuestion()})),o=n.getBounds(),r=Math.round(o.height);let l=0;if(a<e.options.length-1){const i=this.add.text(512,t,e.options[a+1].text,{fontFamily:"Pixelify Sans",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:2,align:"center",wordWrap:{width:682.6666666666667}}).setOrigin(.5);l=Math.round(i.getBounds().height),i.destroy()}return console.log("previousHeight:",i),console.log("currentHeight:",r),console.log("nextHeight:",l),t+=i>r&&l>r?i+20:i>r&&l<=r?i:r+20,i=r,n}))}finishQuestions(){const e=this.determineHouse(),t=this.answers.name;localStorage.removeItem("currentQuestionIndex"),localStorage.removeItem("answers"),localStorage.setItem("playerHouse",e),localStorage.setItem("playerName",t),localStorage.setItem("currentScene","Institute"),this.scene.start("Institute")}determineHouse(){const e={ceres:0,minerva:0,diana:0,mercury:0,juno:0,jupiter:0,venus:0,apollo:0,mars:0,vulcan:0};for(const s in this.answers){const t=this.answers[s];for(const i in t)e[i]+=t[i]}let t=null,i=0;for(const s in e)e[s]>i&&(t=s,i=e[s]);return t}}const p={daniel:{name:"Daniel O'Nagasos",folder:"daniel",side:"left"},banic:{name:"Banic O'Nagasos",folder:"banic",side:"left"}},f=[{character:"banic",expression:"neutral",text:"Banic watches the player for a moment, his expression unreadable.",style:"Italic",x:200,y:600},{character:"banic",expression:"neutral",text:"I'm Banic O'Nagasos.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"He gestures to Daniel, who stands nearby, serious but silent.",style:"Italic",x:200,y:600},{character:"banic",expression:"neutral",text:"And this is my nephew, Daniel. You’ve been through a lot, but there's more you need to understand.",style:"Normal",x:200,y:600},{character:"daniel",expression:"neutral",text:"Hey. I brought you out of the mines. You were... in bad shape.",style:"Normal",x:200,y:600},{character:"daniel",expression:"sad",text:"And for what it's worth, I am sorry that this has happened to you...",style:"Normal",x:200,y:600},{character:"player",expression:"",text:"Still reeling from the recent events, you frown, your voice tentative.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"What do you mean? What’s going on? Why did you save me?",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"Banic takes a deep breath, his gaze steady as he begins to explain.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"You’ve been living a lie, like all low-reds. You think you know your place, your worth... but you don’t. None of us do.",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"He pauses, letting the weight of his words sink in before continuing.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"You’ve been told that the work you do, the sweat and blood you pour into the mines, is for the greater good. That it's all for the terraforming of Mars, to make it habitable for future generations.",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"Banic’s voice turns bitter, his eyes narrowing as he speaks.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"But that’s a lie. Mars... it’s already habitable. Has been for generations. The air you’re fighting to create, the soil you break your back to cultivate... it’s all a sham.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"He watches the your reaction closely, knowing this truth is hard to swallow.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"Your eyes widen in disbelief, Your voice shaking.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"No... that can’t be true. We’ve been told... we’ve seen the reports, the progress...",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"Banic shakes his head, his expression grim.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"Those reports are fabricated, fed to us to keep us in line. To keep us working. The truth is, Mars has been terraformed for a long time. The Golds and their kin live in cities, in comfort, while we toil underground, believing we’re saving the future.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"He steps closer, his voice lowering to a conspiratorial tone.",style:"Italic",x:200,y:600},{character:"banic",expression:"neutral",text:"We’re nothing more than slaves. Tools, used and discarded when we’re no longer needed. The Golds... they built their empire on our backs, and they’ll do anything to keep it that way.",style:"Normal",x:200,y:600},{character:"player",expression:"",text:"Your voice rises, anger and confusion mixing as they try to make sense of it all.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"Then why didn’t anyone tell us? Why hasn’t anyone tried to stop this? To fight back?",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"Banic’s expression hardens, his voice filled with a quiet fury.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"Some have tried, but the Golds are ruthless. They crush any rebellion before it can take root. They control everything—the information, the resources, even the air we breathe.",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"He gestures to the surroundings, the lush green landscape of Mars looming outside the window.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"Look around you. This planet, this life... it’s all a cage. And the worst part? We didn’t even know we were in one. Until now.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"Banic pauses, letting the silence settle in, heavy with the weight of their reality.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"Your voice, quieter now, the enormity of the situation dawning on you.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"So... what do we do? How do we fight back against something so... so huge?",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"Banic’s gaze locks onto the you, his voice steady and resolute.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"We fight smart. We don’t just challenge them head-on; that would be suicide. We infiltrate, we deceive, and we strike from within. That’s where you come in.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"He steps closer, his tone intensifying.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"You have to become one of them. A Gold. Live among them, rise through their ranks, and when the time is right... you change things. From the inside.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"He lets that sink in, knowing it’s no small task he’s asking for.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"You hesitates, your voice barely above a whisper.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"Become a Gold? But how... how could I ever do that? How could I betray everything I am?",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"Banic’s voice softens, a rare moment of empathy shining through.",style:"Italic",x:200,y:600},{character:"banic",expression:"neutral",text:"You wouldn’t be betraying who you are... you’d be honoring it. By doing this, you’d be giving our people a chance. A chance they never had before.",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"He meets the your eyes, his voice resolute.",style:"Italic",x:200,y:600},{character:"banic",expression:"serious",text:"You won\t be alone in this, there are others who have gone before you, and paved a way.",style:"Normal",x:200,y:600},{character:"banic",expression:"serious",text:"The question is... are you willing to take that chance?",style:"Normal",x:200,y:600},{character:"player",expression:"",text:"You look at Banic, then at Daniel, your resolve hardening.",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"I am.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"Banic nods, a flicker of pride in his eyes.",style:"Italic",x:200,y:600},{character:"banic",expression:"neutral",text:"Then let us begin.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"Banic gestures to the carving tools on the table, a silent invitation to join them.",style:"Italic",x:200,y:600},{character:"banic",expression:"neutral",text:"It’s time to carve your path. First I am going to ask you various questions, this will help us know what kind of gold to shape you into.",style:"Normal",x:200,y:600},{character:"banic",expression:"neutral",text:"Are you ready? Once this is done, and you've been trained up, you'll be sent to the Mars institute",style:"Italic",x:200,y:600},{character:"player",expression:"",text:"You nods, determination in your eyes.",style:"Italic",x:200,y:600}];class y extends e.Scene{constructor(){super("Carving"),this.currentDialogueIndex=0,this.currentQuestionIndex=null,this.answers={},this.pointerdownListener=null}preload(){this.load.image("daniel_happy","assets/daniel/happy.png"),this.load.image("daniel_neutral","assets/daniel/neutral.png"),this.load.image("daniel_pity","assets/daniel/pity.png"),this.load.image("daniel_sad","assets/daniel/sad.png"),this.load.image("daniel_serious","assets/daniel/serious.png"),this.load.image("banic_serious","assets/banic/serious.png"),this.load.image("banic_happy","assets/banic/happy.png"),this.load.image("banic_neutral","assets/banic/neutral.png")}create(){this.cameras.main.setBackgroundColor(0),this.add.image(512,384,"city").setAlpha(.5),this.characterImages={};for(const e in p){const t=p[e];this.characterImages[e]=this.add.image(0,0,`${t.folder}_neutral`).setVisible(!1)}this.dialogueText=this.add.text(512,668,"",{fontFamily:"Pixelify Sans",fontSize:24,color:"#ffffff",stroke:"#000000",strokeThickness:2,wordWrap:{width:984}}).setOrigin(.5),this.loadIndices(),null!=this.currentQuestionIndex?this.scene.start("CarvingQuestions"):(this.pointerdownListener=this.input.on("pointerdown",this.nextDialogue,this),this.showCurrentDialogue())}loadIndices(){const e=localStorage.getItem("currentDialogueIndex");null!==e&&(this.currentDialogueIndex=parseInt(e,10));const t=localStorage.getItem("currentQuestionIndex");null!==t&&(this.currentQuestionIndex=parseInt(t,10))}saveDialogueIndex(){localStorage.setItem("currentDialogueIndex",this.currentDialogueIndex)}clearDialouge(){this.dialogueText.destroy(),localStorage.removeItem("currentDialogueIndex");for(const e in this.characterImages)this.characterImages[e].destroy()}showCurrentDialogue(){if(this.currentDialogueIndex>=f.length)return;const e=f[this.currentDialogueIndex],t=p[e.character];for(const o in this.characterImages)this.characterImages[o]&&this.characterImages[o].setVisible(!1);const i=["system","player"];if(e.expression&&!i.includes(e.character)){const i=`${t.folder}_${e.expression}`;let s=200;"right"===t.side&&(s=824),this.characterImages[e.character]?(this.characterImages[e.character].setTexture(i),this.characterImages[e.character].setPosition(s,600)):this.characterImages[e.character]=this.add.image(s,600,i),this.characterImages[e.character].setVisible(!0)}let s="Normal";e.style&&(s=e.style);const a={fontFamily:"Arial",fontSize:24,color:"#ffffff",align:"center",wordWrap:{width:512},fontStyle:s.toLowerCase()};this.dialogueText.setStyle(a);let n="";"player"===e.character?n=`You: ${e.text}`:"system"===e.character?n=e.text:(console.log(e),n=`${t.name}: ${e.text}`),this.dialogueText.setText(n),i.includes(e.character)?(this.dialogueText.setX(512),this.dialogueText.setOrigin(.5)):"left"===t.side?(this.dialogueText.setX(412),this.dialogueText.setOrigin(0,.5)):"right"===t.side&&(this.dialogueText.setX(612),this.dialogueText.setOrigin(1,.5))}nextDialogue(){this.currentDialogueIndex++,this.currentDialogueIndex<f.length?(this.saveDialogueIndex(),this.showCurrentDialogue()):(localStorage.removeItem("currentDialogueIndex"),localStorage.setItem("currentQuestionIndex",0),localStorage.setItem("currentScene","CarvingQuestions"),this.scene.start("CarvingQuestions"))}}class v{constructor(e,t,i,s=null,a=null,n=!1,o=!1){this.q=e,this.r=t,this.biome=i,this.icon=null,this.isOutpost=n,this.isCastle=o,this.units=0,this.wood=0,this.stone=0,this.food=0,this.defenseBonus=0,this.movementPenalty=1,this.initializeResourcesAndBonuses()}initializeResourcesAndBonuses(){switch(this.biome){case"forest":this.wood=this.randomInRange(5,15);break;case"tundra":this.wood=this.randomInRange(5,10),this.food=this.randomInRange(5,10);break;case"greatwood":this.wood=this.randomInRange(5,15),this.movementPenalty=1.5;break;case"hill":this.stone=this.randomInRange(5,15);break;case"mountain":this.stone=this.randomInRange(10,25),this.movementPenalty=1.5;break;case"grassland":this.food=this.randomInRange(5,15);break;case"farmland":this.food=this.randomInRange(10,25);break;case"swamp":this.movementPenalty=1.5}this.isOutpost&&(this.defenseBonus=.1),this.isCastle&&(this.defenseBonus=.2)}randomInRange(e,t){return Math.floor(Math.random()*(t-e+1))+e}static determineBiome(e){return e<-.9?"deep":e<-.7?"shallow":e<.5?"grassland":e<.8?"hill":"mountain"}static determineFlatBiome(e){return e<-.9?"swamp":e<-.7?"tundra":e<.5?Math.random()<.8?"grassland":"farmland":e<.8?"forest":"greatwood"}serialize(){return{q:this.q,r:this.r,biome:this.biome,border:this.border,house:this.house,icon:this.icon,isOutpost:this.isOutpost,isCastle:this.isCastle,units:this.units,wood:this.wood,stone:this.stone,food:this.food,defenseBonus:this.defenseBonus,movementPenalty:this.movementPenalty}}static deserialize(e){const t=new v(e.q,e.r,e.biome,null,null,e.isOutpost,e.isCastle);return t.icon=e.icon,t.units=e.units,t.wood=e.wood,t.stone=e.stone,t.food=e.food,t.defenseBonus=e.defenseBonus,t.movementPenalty=e.movementPenalty,t.house=e.house,t.border=e.border,t}}const w=Math.sqrt(3),x=.5*(w-1),b=(3-w)/6,S=e=>0|Math.floor(e),M=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function T(e=Math.random){const t=function(e){const t=512,i=new Uint8Array(t);for(let s=0;s<256;s++)i[s]=s;for(let s=0;s<255;s++){const t=s+~~(e()*(256-s)),a=i[s];i[s]=i[t],i[t]=a}for(let s=256;s<t;s++)i[s]=i[s-256];return i}(e),i=new Float64Array(t).map((e=>M[e%12*2])),s=new Float64Array(t).map((e=>M[e%12*2+1]));return function(e,a){let n=0,o=0,r=0;const l=(e+a)*x,h=S(e+l),c=S(a+l),u=(h+c)*b,d=e-(h-u),g=a-(c-u);let m,p;d>g?(m=1,p=0):(m=0,p=1);const f=d-m+b,y=g-p+b,v=d-1+2*b,w=g-1+2*b,M=255&h,T=255&c;let k=.5-d*d-g*g;if(k>=0){const e=M+t[T];k*=k,n=k*k*(i[e]*d+s[e]*g)}let _=.5-f*f-y*y;if(_>=0){const e=M+m+t[T+p];_*=_,o=_*_*(i[e]*f+s[e]*y)}let C=.5-v*v-w*w;if(C>=0){const e=M+1+t[T+1];C*=C,r=C*C*(i[e]*v+s[e]*w)}return 70*(n+o+r)}}class k{constructor(e,t){this.tileSize=e,this.sideLength=t,this.noise=new T,this.secondaryNoise=new T,this.frequency=.05,this.flatBiomeFrequency=.1,this.minDistance=5,this.numCastles=13,this.iconPools={grassland:["grassland_1"],forest:["forest_1","forest_2","forest_3"],farmland:["farmland_1","squiggle_1","squiggle_2","squiggle_3"],greatwood:["greatwood_1","greatwood_2","greatwood_3","greatwood_4"],hill:["hill_1","hill_2","hill_3","hill_4","hill_5","hill_6"],mountain:["mountain_1","mountain_2","mountain_3","mountain_4","mountain_5","mountain_6"],swamp:["swamp_1","swamp_2","swamp_3","swamp_4"],tundra:["tundra_1","tundra_2","tundra_3","tundra_4"],outpost:["outpost_1","outpost_2","outpost_3","outpost_4","outpost_5"],shallow:["squiggle_1","squiggle_2","squiggle_3"],deep:["squiggle_1","squiggle_2","squiggle_3"]}}getRandomIcon(e){const t=this.iconPools[e]||[];return Math.random()<.6||0===t.length?null:t[Math.floor(Math.random()*t.length)]}generateMapData(){const e=[];for(let t=1-this.sideLength;t<this.sideLength;t++){const i=Math.max(1-this.sideLength,-t-this.sideLength+1),s=Math.min(this.sideLength-1,-t+this.sideLength-1);for(let a=i;a<=s;a++){const i=this.noise(t*this.frequency,a*this.frequency);let s=v.determineBiome(i);if("grassland"===s){const e=this.secondaryNoise(t*this.flatBiomeFrequency,a*this.flatBiomeFrequency);s=v.determineFlatBiome(e)}const n=new v(t,a,s);n.initializeResourcesAndBonuses(),"shallow"!==s&&"deep"!==s&&Math.random()<.01?(n.isOutpost=!0,n.icon=this.getRandomIcon("outpost")):n.icon=this.getRandomIcon(s),e.push(n)}}return this.generateCastles(e,this.minDistance,this.numCastles),e}getAdjacentBiomes(e,t,i){return[{dq:1,dr:0},{dq:-1,dr:0},{dq:0,dr:1},{dq:0,dr:-1},{dq:1,dr:-1},{dq:-1,dr:1}].map((s=>{const a=e.find((e=>e.q===t+s.dq&&e.r===i+s.dr));return a?a.type:null})).filter((e=>null!==e))}isValidCastleTile(e,t,i){const s=["shallow","deep","swamp"];return!this.getAdjacentBiomes(e,t,i).some((e=>s.includes(e)))}distance(e,t){return Math.sqrt(Math.pow(e.q-t.q,2)+Math.pow(e.r-t.r,2))}findCastleLocations(e,t,i){const s=[];for(let n of e)this.isValidCastleTile(e,n.q,n.r)&&s.push(n);const a=[];for(;a.length<i&&s.length>0;){const e=Math.floor(Math.random()*s.length),i=s.splice(e,1)[0];let n=!0;for(let s of a)if(this.distance(i,s)<t){n=!1;break}n&&a.push(i)}return a.length<i?[]:a}generateCastles(e,t,i){let s=[];for(;s.length<i;)s=this.findCastleLocations(e,t,i);console.log(s);const a={apollo:{name:"apollo",border:"apollo_border"},baccus:{name:"bacchus",border:"bacchus_border"},ceres:{name:"ceres",border:"ceres_border"},diana:{name:"diana",border:"diana_border"},juno:{name:"juno",border:"juno_border"},jupiter:{name:"jupiter",border:"jupiter_border"},mars:{name:"mars",border:"mars_border"},mercury:{name:"mercury",border:"mercury_border"},minerva:{name:"minerva",border:"minerva_border"},neptune:{name:"neptune",border:"neptune_border"},pluto:{name:"pluto",border:"pluto_border"},venus:{name:"venus",border:"venus_border"},vulcan:{name:"vulcan",border:"vulcan_border"}};for(let n=0;n<s.length;n++){const e=Object.keys(a),t=e[n%e.length],i=a[t].name,o=a[t].border,r=s[n];r.biome="castle",r.icon=i,r.units=50,r.isCastle=!0,r.house=i,r.border=o}}}class _{constructor(e,t){this.scene=e,this.margin=t,this.mode="default"}createOverlay(){const e=this.scene.cameras.main.width,t=this.scene.cameras.main.height,i=this.scene.add.graphics();return i.fillStyle(3355443,1),i.fillRect(0,0,e,this.margin),i.fillRect(0,t-this.margin,e,this.margin),i.fillRect(0,this.margin,this.margin,t-2*this.margin),i.fillRect(e-this.margin,this.margin,this.margin,t-2*this.margin),i.setScrollFactor(0),i.setDepth(1e3),this.turnText=this.scene.add.text(e/2,this.margin/2,"Player's Turn",{fontSize:"24px",fill:"#ffffff",fontFamily:"Pixelify Sans"}).setOrigin(.5).setScrollFactor(0).setDepth(1001),this.actionPointsText=this.scene.add.text(4*e/6,t-this.margin/2,"Action Points: 0",{fontSize:"18px",fill:"#ffffff",fontFamily:"Pixelify Sans"}).setOrigin(.5).setScrollFactor(0).setDepth(1001),this.chatBox=this.scene.add.text(this.margin,t-this.margin,"System Messages",{fontSize:"24px",fill:"#ffffff",backgroundColor:"#000000",padding:{x:10,y:5},wordWrap:{width:200},fontFamily:"Pixelify Sans"}).setOrigin(0,1).setScrollFactor(0).setDepth(1001),this.createHelpButton(),i}createHelpButton(){const e=this.scene.cameras.main.width,t=this.scene.add.image(e-20-0,120,"help").setOrigin(.5).setScrollFactor(0).setDepth(1001).setInteractive({useHandCursor:!0});return t.on("pointerdown",(()=>{console.log("Info button clicked"),this.showHelpModal()})),t}displayMessage(e){this.chatBox.setVisible(!0),this.chatBox.setText(e),setTimeout((()=>{this.chatBox.setVisible(!1)}),5e3)}updateResources(e,t,i,s){}updateTurnText(e){this.turnText.setText(e)}showHelpModal(){const e=document.getElementById("helpModal"),t=document.getElementsByClassName("close")[0];e.style.display="flex",t.onclick=function(){e.style.display="none"},window.onclick=function(t){t.target==e&&(e.style.display="none")}}createEndTurnButton(e){const t=this.scene.cameras.main.width,i=this.scene.add.text(t-50-10,20,"End Turn",{fill:"#00cd0d",fontSize:"20px",fontFamily:"Pixelify Sans"}).setOrigin(.5).setScrollFactor(0).setDepth(1001).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{console.log("Button clicked"),e()})).on("pointerover",(()=>i.setStyle({fill:"#0f0"}))).on("pointerout",(()=>i.setStyle({fill:"#00cd0d"})));return this.scene.input.setTopOnly(!0),i}createToggleViewButton(e){}}class C{constructor(e){this.scene=e,this.isPanning=!1,this.panStartX=0,this.panStartY=0}initializeCamera(e,t,i=1){const s=this.scene.cameras.main.width,a=this.scene.cameras.main.height;this.scene.cameras.main.scrollX=e-s/2,this.scene.cameras.main.scrollY=t-a/2,this.scene.cameras.main.setZoom(i)}setZoom(e){this.scene.cameras.main.setZoom(e)}enablePanning(){this.scene.input.on("pointerdown",(e=>{e.middleButtonDown()&&(this.isPanning=!0,this.panStartX=e.x,this.panStartY=e.y)})),this.scene.input.on("pointerup",(e=>{e.middleButtonReleased()&&(this.isPanning=!1)})),this.scene.input.on("pointermove",(e=>{if(this.isPanning){const t=this.panStartX-e.x,i=this.panStartY-e.y;this.scene.cameras.main.scrollX+=t,this.scene.cameras.main.scrollY+=i,this.panStartX=e.x,this.panStartY=e.y}}))}}class I{constructor(e,t,i,s,a){this.playerManager,this.scene=e,this.mapData=t,this.tileSize=i,this.playerHouse=s,this.houses=a,console.log("MapManager initialized with player house:",s),this.fogTiles=[],this.scaleFactor=1,this.zoomFactor=1,this.tileSprites=[],this.tileIcons=[],this.tileBorders=[],this.firstSplitMap=new Map,this.calculateHexSize()}getMapData(){return this.mapData}setPlayerManager(e){this.playerManager=e}changeRenderMode(e){["normal","resource"].includes(e)&&(this.renderMode=e)}async renderMap(){console.log("Rendering map");const e=new Set(this.playerHouse.revealedTiles.map((e=>`${e.q},${e.r}`)));this.tooltip||this.createTooltip(),e.forEach((e=>{const[t,i]=e.split(",").map(Number),s=this.mapData.find((e=>e.q===t&&e.r===i));if(!s)return;let a,n,o,r;if(s.x||s.y?(a=s.x,n=s.y):(a=this.hexWidth*(3/4*t),n=this.hexHeight*(i+t/2),s.x=a,s.y=n),o=s.house?this.scene.add.image(a,n,s.border):this.scene.add.image(a,n,"normal_border"),this.tileBorders.push(o),r=s.house?this.scene.add.image(a,n,s.biome+"_occupied"):this.scene.add.image(a,n,s.biome),this.tileSprites.push(r),r.setInteractive(),r.on("pointerdown",(e=>this.playerManager.handleMapClick(e,s))),r.on("pointerover",(()=>{const e=this.calculateActionCost(this.playerHouse,this.selectedTile,s,1,"move"),t=`Tile: ${s.q}, ${s.r}\nBiome: ${s.biome}\nUnits: ${s.units}\nAction Cost: ${e}`;this.showTooltip(a,n-20,t)})),r.on("pointerout",(()=>{this.hideTooltip()})),s.units>0){const e=this.scene.add.text(a,n+25,s.units,{fontSize:"20px",fill:"#000"});e.setOrigin(.5),e.tile=s,this.tileSprites.push(e)}if(s.icon){let e;e=!s.units>0?this.scene.add.image(a,n,s.icon):this.scene.add.image(a,n-10,s.icon+"_small"),e.setAlpha(.5),e.tile=s,this.tileIcons.push(e)}})),e.forEach((e=>{const[t,i]=e.split(",").map(Number);this.getAdjacentTiles(t,i).forEach((e=>{const t=this.mapData.find((t=>t.q===e.q&&t.r===e.r)),i=this.playerHouse.revealedTiles.some((t=>t.q===e.q&&t.r===e.r));if(t&&!i){const{x:t,y:i}=this.getTileCoordinates(e.q,e.r),s=this.scene.add.image(t,i,"fog");s.tile=e,this.fogTiles.push(s)}}))})),this.scene.saveProgress()}async rerenderMap(){let e=Date.now();console.log("Rerendering map started"),this.tileSprites.forEach((e=>e.destroy())),this.fogTiles.forEach((e=>e.destroy())),this.tileIcons.forEach((e=>e.destroy())),this.tileBorders.forEach((e=>e.destroy())),this.tileSprites=[],this.fogTiles=[],this.tileIcons=[],this.tileBorders=[],this.calculateHexSize(),await this.renderMap(),console.log("Rerendering map finished in",Date.now()-e,"ms")}checkActionValidity(e,t,i){return e?t?i?this.isOwnedByHouse(t,e)?t.units<1?(this.scene.displayMessage("No units to move"),!1):t===i?(this.scene.displayMessage("Cannot move units to the same tile"),!1):this.isAdjacent(t,i)?"deep"!==i.biome&&"shallow"!==i.biome||(this.scene.displayMessage("Cannot move units to water tiles"),!1):(this.scene.displayMessage("Clicked tile is not adjacent to the selected tile"),!1):(this.scene.displayMessage("Selected tile is not owned by the player"),!1):(this.scene.displayMessage("No destination tile selected"),!1):(this.scene.displayMessage("No source tile selected"),!1):(this.scene.displayMessage("No house selected"),!1)}async attackTile(e,t){const i=await this.calculateNearbyOwnedTiles(e),s=await this.calculateDistanceFromCastle(e),a=await this.calculateNearbyOwnedTiles(t),n=await this.calculateDistanceFromCastle(t);let o=await this.findNearestCastleOrOutpost(e),r=await this.findNearestCastleOrOutpost(t);console.log("Attacker return location:",o),console.log("Defender return location:",r),o||(o=this.mapData.find((t=>t.house===e.house))),r||(r=this.mapData.find((e=>e.house===t.house)));const l=e.units+i-s,h=t.units+a-n;console.log("Attacker strength:",l),console.log("Defender strength:",h);const c=this.calculateInstantVictory(l,h);if("attacker"===c)this.instantVictory(e,t);else if("defender"===c)this.instantVictory(t,e);else{const i=this.battle(l,h);"attacker"===i?this.attackerWins(e,t,o,r):"defender"===i?this.defenderWins(e,t,o,r):(o&&this.transferLostUnits(e,o,e.units),r&&this.transferLostUnits(t,r,t.units))}}battle(e,t){const i=e+L(),s=t+L();return i>s?"attacker":s>i?"defender":"draw"}calculateInstantVictory(e,t){return e>=3*t?"attacker":t>=3*e?"defender":null}instantVictory(e,t){const i=this.houses.find((t=>t.name.toLowerCase()===e.house));this.houses.find((e=>e.name.toLowerCase()===t.house)).removeUnits(t.units),i.addUnits(t.units),t.units+=e.units,t.house=e.house,t.border=e.border,e.units=0}defenderWins(e,t,i,s){console.log("Defender wins");const a=L(),n=Math.min(a,t.units);this.transferLostUnits(e,s,n);const o=this.houses.find((t=>t.name.toLowerCase()===e.house)),r=this.houses.find((e=>e.name.toLowerCase()===t.house)),l=L();let h=0;l<e.units&&(h=l),this.transferLostUnits(e,i,h);const c=t.units-h;this.transferLostUnits(e,s,c),r.addUnits(c),o.removeUnits(c)}attackerWins(e,t,i,s){console.log("Attacker wins");const a=L(),n=Math.min(a,e.units);this.transferLostUnits(e,i,n);const o=this.houses.find((t=>t.name.toLowerCase()===e.house)),r=this.houses.find((e=>e.name.toLowerCase()===t.house));console.log("Attacker house:",o),console.log("Defender house:",r);const l=L();let h=0;l<t.units&&(h=l),this.transferLostUnits(t,s,h);const c=t.units-h;this.transferLostUnits(t,i,c),o.addUnits(c),r.removeUnits(c)}async calculateNearbyOwnedTiles(e){return this.mapData.filter((t=>t.house===e.house)).filter((t=>Math.abs(t.q-e.q)+Math.abs(t.r-e.r)+Math.abs(t.q+t.r-e.q-e.r)<=1)).length}async calculateDistanceFromCastle(e){const t=this.mapData.filter((t=>t.house==e.house&&(t.isCastle||t.isOutpost)));let i=1/0;for(const s of t){const t=Math.abs(s.q-e.q)+Math.abs(s.r-e.r)+Math.abs(s.q+s.r-e.q-e.r);console.log("Distance from castle:",t),i=Math.min(i,t)}return i}async findNearestCastleOrOutpost(e){const t=this.mapData.filter((t=>t.house==e.house&&(t.isCastle||t.isOutpost)));let i=1/0,s=null;for(const a of t){const t=Math.abs(a.q-e.q)+Math.abs(a.r-e.r)+Math.abs(a.q+a.r-e.q-e.r);t<i&&(i=t,s=a)}return s}async transferUnits(e,t,i){return e.units<i&&(i=e.units),t.house&&t.house!==e.house?await this.attackTile(e,t):(e.units-=i,t.units+=i),0==e.units?t:e}async transferLostUnits(e,t,i){e.units-=i,t.units+=i}async moveUnits(e,t,i,s){if(!this.checkActionValidity(e,t,i))return;await this.handleTileReveal(e,t,i);let a=await this.transferUnits(t,i,s);return await this.rerenderMap(),a}async moveOneUnit(e,t,i){if(!this.checkActionValidity(e,t,i))return;await this.handleTileReveal(e,t,i);let s=await this.transferUnits(t,i,1);return await this.rerenderMap(),s}async moveHalfUnits(e,t,i){if(!this.checkActionValidity(e,t,i))return;const s=Math.floor(t.units/2);await this.handleTileReveal(e,t,i);let a=await this.transferUnits(t,i,s);return await this.rerenderMap(),a}async moveAllUnits(e,t,i){if(!this.checkActionValidity(e,t,i))return;await this.handleTileReveal(e,t,i);let s=await this.transferUnits(t,i,t.units);return await this.rerenderMap(),s}calculateActionCost(e,t,i,s,a){console.log(t,i);let n=1;if("split"===a){const e=`${t.q},${t.r}`,s=`${i.q},${i.r}`;this.firstSplitMap.has(e)||this.firstSplitMap.set(e,new Set);const a=this.firstSplitMap.get(e);a.has(s)?n=0:(n=i.house?.25:1,a.add(s))}else i.house?i.house!==e.name.toLowerCase()?n=1:n*=.75:n=1,["greatwoods","swamp","mountain"].includes(i.biome)&&(n*=1.5);return n}resetFirstSplits(){this.firstSplitMap.clear()}areTilesAdjacent(e,t){return this.getAdjacentTiles(e.q,e.r).some((e=>e.q===t.q&&e.r===t.r))}async handleTileReveal(e,t,i){if(i.house!==t.house&&0==i.units){i.house=t.house,i.border=t.border;const s=this.mapData.find((e=>e.q===i.q&&e.r===i.r));return s&&(s.house=i.house,s.border=i.border),await this.revealAdjacentTiles(e,i.q,i.r),!0}return!1}showTileDetails(e){console.log("Showing details for tile:",e)}isOwnedByHouse(e,t){return e.house===t.name.toLowerCase()}isAdjacent(e,t){return this.getAdjacentTiles(e.q,e.r).some((e=>e.q===t.q&&e.r===t.r))}getTileAt(e,t){return this.mapData.find((i=>{const s=this.hexWidth*(3/4*i.q),a=this.hexHeight*(i.r+i.q/2);return Phaser.Math.Distance.Between(e,t,s,a)<this.tileSize/2}))}calculateHexSize(){this.hexWidth=this.tileSize,this.hexHeight=Math.sqrt(3)/2*this.hexWidth}getAdjacentTiles(e,t){return[{dq:1,dr:0},{dq:-1,dr:0},{dq:0,dr:1},{dq:0,dr:-1},{dq:1,dr:-1},{dq:-1,dr:1}].map((i=>({q:e+i.dq,r:t+i.dr})))}async revealTile(e,t,i){this.mapData.find((e=>e.q===t&&e.r===i))&&(e.revealedTiles.some((e=>e.q===t&&e.r===i))||e.revealedTiles.push({q:t,r:i}))}async revealAdjacentTiles(e,t,i){const s=this.getAdjacentTiles(t,i);for(const a of s)await this.revealTile(e,a.q,a.r)}revealHouseTiles(e){e.forEach((e=>{this.getCastleTiles().forEach((t=>{t.house===e.name.toLowerCase()&&(this.revealTile(e,t.q,t.r),this.revealAdjacentTiles(e,t.q,t.r))}))}))}revealAllTiles(e){this.mapData.forEach((t=>{e.revealedTiles.some((e=>e.q===t.q&&e.r===t.r))||e.revealedTiles.push({q:t.q,r:t.r})})),this.rerenderMap()}getCastleTiles(){return this.mapData.filter((e=>e.isCastle))}getTileCoordinates(e,t){return{x:this.hexWidth*(3/4*e),y:this.hexHeight*(t+e/2)}}getTile(e,t){return this.mapData.find((i=>i.q===e&&i.r===t))}createTooltip(){this.tooltip=this.scene.add.text(0,0,"",{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5},borderRadius:5}).setDepth(100).setVisible(!1)}showTooltip(e,t,i){this.tooltip.setText(i),this.tooltip.setPosition(e,t),this.tooltip.setVisible(!0)}hideTooltip(){this.tooltip.setVisible(!1)}}function L(){return Math.floor(6*Math.random())+1}i.GameObjects.Container;class D{constructor(e,t,i){this.scene=e,this.mapManager=t,this.selectedTile=null,this.house=i,this.cursors=this.scene.input.keyboard.createCursorKeys(),this.ctrlKey=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.CTRL),this.altKey=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ALT),this.endTurnButton=null,this.endTurnResolve=null,this.locked=!0,this.overlayManager=new _(this.scene,40),this.overlay=this.overlayManager.createOverlay(),this.overlayManager.createToggleViewButton(this.changeRenderMode.bind(this)),this.overlayManager.showHelpModal()}changeRenderMode(e){this.mapManager.changeRenderMode(e)}async notifyTurn(e){if(e===this.house.name)return await this.mapManager.rerenderMap(),this.overlayManager.updateResources(this.house.resources.food,this.house.resources.wood,this.house.resources.stone,this.house.actionPoints),this.unlockControls(),this.endTurnButton=this.overlayManager.createEndTurnButton(this.endTurn.bind(this)),new Promise((e=>{this.endTurnResolve=e}));this.lockControls()}endTurn(){this.endTurnButton&&(this.endTurnButton.destroy(),this.endTurnButton=null),this.endTurnResolve&&(this.endTurnResolve(),this.endTurnResolve=null),this.house.resetActionPoints(),this.overlayManager.updateResources(this.house.resources.food,this.house.resources.wood,this.house.resources.stone,this.house.actionPoints),this.lockControls()}setTurnManager(e){this.turnManager=e}lockControls(){this.locked=!0}unlockControls(){this.locked=!1}async handleMapClick(e,t){if(t)if(e.leftButtonDown())this.selectedTile=t,this.mapManager.showTileDetails(t);else if(e.rightButtonDown()){if(this.locked)return;if(!this.selectedTile)return void this.overlayManager.displayMessage("Select a tile first");let e;if(this.ctrlKey.isDown)e=await this.mapManager.calculateActionCost(this.house,this.selectedTile,t,1,"split");else if(this.altKey.isDown){const i=Math.floor(this.selectedTile.units/2);e=await this.mapManager.calculateActionCost(this.house,this.selectedTile,t,i,"split")}else e=await this.mapManager.calculateActionCost(this.house,this.selectedTile,t,this.selectedTile.units,"all");if(!this.house.canPerformAction(e))return void this.overlayManager.displayMessage("Not enough action points");let i=null;i=this.ctrlKey.isDown?await this.mapManager.moveOneUnit(this.house,this.selectedTile,t):this.altKey.isDown?await this.mapManager.moveHalfUnits(this.house,this.selectedTile,t):await this.mapManager.moveAllUnits(this.house,this.selectedTile,t),i?(this.house.actionPoints-=e,this.selectedTile=i,this.overlayManager.updateResources(this.house.food,this.house.wood,this.house.stone,this.house.actionPoints)):this.overlayManager.displayMessage("Invalid move")}}}class E{constructor(e){this.aiManager=e}async makeDecision(){await this.aiManager.analyzeMap();const e=await this.aiManager.getVisibleTiles(),t=await this.aiManager.getTilesWithUnits(),i=[];return await Promise.all(t.map((async t=>{await this.shouldDefend(t)?i.push(await this.defend(t)):await this.shouldRetreat(t)?i.push(await this.retreat(t)):await this.shouldAttack(t)?i.push(await this.attack(t)):await this.shouldExplore(t)?i.push(await this.explore(t)):await this.shouldTakeCastle(t)?i.push(await this.takeCastle(t)):i.push(await this.randomRoaming(t,e))}))),console.log(i),i}async shouldRetreat(e){const t=await this.aiManager.getThreats(e);return!!t&&t.length>0&&e.units<Math.max(...t.map((e=>e.units)))}async retreat(e){const t=await this.aiManager.findSafeTile(e);return t?{type:"Retreat",tile:e,targetTile:t}:null}async shouldAttack(e){const t=await this.aiManager.getNearbyEnemies(e);return!!t&&t.some((t=>e.units>t.units))}async attack(e){const t=await this.aiManager.getWeakestEnemy(e);return console.log(t),t?{type:"Attack",tile:e,targetTile:t.tile}:null}async shouldDefend(e){const t=await this.aiManager.isNearCastle(e),i=await this.aiManager.isCastleUnderThreat(),s=await this.aiManager.getNearbyEnemies(e);return!!s&&t&&(i||s.length>0)}async defend(e){const t=await this.aiManager.getCastleTile(),i=await this.aiManager.getNearbyEnemies(e);if(!t||!i)return null;if(i.length>0){const t=i.reduce(((t,i)=>{const s=Math.abs(e.q-i.q)+Math.abs(e.r-i.r);return s<t.distance?{enemy:i,distance:s}:t}),{enemy:null,distance:1/0}).enemy;return{type:"Defend",tile:e,targetTile:t.tile}}return{type:"Defend",tile:e,targetTile:t}}async shouldExplore(e){const t=await this.aiManager.getVisibleTiles();return!!t&&!this.aiManager.isNearCastle(e)&&t.length<this.aiManager.getTotalTiles()}async explore(e){const t=await this.aiManager.getUnexploredTile(e);return t?{type:"Explore",tile:e,targetTile:t}:null}async shouldTakeCastle(e){const t=await this.aiManager.getClosestEnemyCastle(e);if(!t)return!1;const i=await this.aiManager.getNearbyEnemies(e);if(!i)return!1;const s=t.units+i.reduce(((e,t)=>e+t.units),0);return e.units>s}async takeCastle(e){const t=await this.aiManager.getClosestEnemyCastle(e);return t?{type:"Take Castle",tile:e,targetTile:t}:null}async randomRoaming(e,t){return t&&0!==t.length?{type:"Random Roaming",tile:e,targetTile:t[Math.floor(Math.random()*t.length)]}:null}}class q{constructor(e,t){this.aiManager=e,this.movementManager=t}async executeDecision(e){for(const t of e)switch(console.log(t),t.type){case"Retreat":await this.retreat(t.tile,t.targetTile);break;case"Attack":await this.attack(t.tile,t.targetTile);break;case"Defend":await this.defend(t.tile,t.targetTile);break;case"Explore":await this.explore(t.tile,t.targetTile);break;case"Take Castle":await this.takeCastle(t.tile,t.targetTile);break;case"Random Roaming":await this.randomRoaming(t.targetTile)}}async retreat(e,t){console.log("Retreating: "+t,"from: ",e);const i=await this.movementManager.findPath(e,t),s=await this.movementManager.followPath(i,e.units);this.aiManager.currentHouse.performAction(s)}async attack(e,t){console.log("Attacking: "+t,"from: ",e);const i=await this.movementManager.findPath(e,t),s=await this.movementManager.followPath(i,e.units);this.aiManager.currentHouse.performAction(s)}async defend(e,t){console.log("Defending: "+t,"from: ",e);const i=await this.movementManager.findPath(e,t),s=await this.movementManager.followPath(i,e.units);this.aiManager.currentHouse.performAction(s)}async explore(e,t){console.log("Exploring: "+t,"from: ",e);const i=await this.movementManager.findPath(e,t);console.log(i);const s=await this.movementManager.followPath(i,e.units);console.log(s),this.aiManager.currentHouse.performAction(s)}async takeCastle(e,t){console.log("Taking Castle: "+t,"from: ",e);const i=await this.movementManager.findPath(e,t),s=await this.movementManager.followPath(i,e.units);this.aiManager.currentHouse.performAction(s)}async randomRoaming(e){console.log("Random Roaming: "+e);const t=await this.aiManager.getTilesWithUnits(),i=t.filter((e=>e.units>15));let s,a=1;if(i.length>0)for(const n of i)if(this.movementManager.pathsBeingFollowed.includes(n)){s=this.movementManager.getPath(n,e);const t=Math.floor(n.units/2);a=await this.movementManager.followPath(s,t)}else{s=await this.movementManager.findPath(n,e);const t=Math.floor(n.units/2);a=await this.movementManager.followPath(s,t)}else if(0===i.length)for(const n of t)this.movementManager.pathsBeingFollowed.includes(n)||(s=await this.movementManager.findPath(n,e),a=await this.movementManager.followPath(s,n.units));else for(const n of t)s=this.movementManager.getPath(n,e),a=await this.movementManager.followPath(s,n.units);this.aiManager.currentHouse.performAction(a)}async splitUnits(e,t){let i=[];for(let s=0;s<e;s+=t)i.push(Math.min(t,e-s));return i}}class B{constructor(e){this.mapManager=e}heuristic(e,t){return Math.abs(e.q-t.q)+Math.abs(e.r-t.r)}cost(e,t){let i=1;return t.units>0&&t.house!==e.house&&(i+=10*t.units),t.isFog&&(i+=3),"mountain"===t.biome&&(i+=5),"hill"===t.biome&&(i+=2),"forest"===t.biome&&(i+=1),"swamp"===t.biome&&(i+=5),"tundra"===t.biome&&(i+=3),i}reconstructPath(e,t){const i=[t];let s=`${t.q},${t.r}`;for(;e.has(s);)s=`${(t=e.get(s)).q},${t.r}`,i.unshift(t);return i}async findPath(e,t){if(!e||!t)return null;const i=new U,s=new Map,a=new Map,n=new Map,o=`${e.q},${e.r}`,r=`${t.q},${t.r}`;for(a.set(o,0),n.set(o,this.heuristic(e,t)),i.enqueue(e,n.get(o));!i.isEmpty();){const e=i.dequeue(),o=`${e.q},${e.r}`;if(o===r)return this.reconstructPath(s,e);const l=this.mapManager.getAdjacentTiles(e.q,e.r);for(const r of l){const l=this.mapManager.getTile(r.q,r.r);if(!l||"shallow"==l.biome||"deep"==l.biome)continue;const h=`${l.q},${l.r}`,c=a.get(o)+this.cost(e,l);(!a.has(h)||c<a.get(h))&&(s.set(h,e),a.set(h,c),n.set(h,c+this.heuristic(l,t)),i.elements.some((e=>e.element===l))||i.enqueue(l,n.get(h)))}}return null}}class U{constructor(){this.elements=[]}isEmpty(){return 0===this.elements.length}enqueue(e,t){this.elements.push({element:e,priority:t}),this.elements.sort(((e,t)=>e.priority-t.priority))}dequeue(){return this.elements.shift().element}}class A{constructor(e,t){this.aiManager=e,this.mapManager=t,this.pathFinder=new B(t),this.pathsBeingFollowed=[]}async findPath(e,t){const i=await this.pathFinder.findPath(e,t);return i&&this.pathsBeingFollowed.push(i),i}getPath(e,t){return this.pathsBeingFollowed.find((i=>i[0]===e&&i[i.length-1]===t))}async followPath(e,t){if(!e||e.length<2)return;const i=e[0],s=e[1];console.log("Path:",e);const a=this.aiManager.getCurrentHouse();let n;return i.units<t&&(t=i.units),n=t<i.units?this.mapManager.calculateActionCost(a,i,s,t,"split"):this.mapManager.calculateActionCost(a,i,s,t,"move"),a.canPerformAction(n)&&await this.mapManager.moveUnits(a,i,s,t),e.shift(),1===e.length&&(this.pathsBeingFollowed=this.pathsBeingFollowed.filter((t=>t!==e))),n}}class P{constructor(e,t,i,s){this.scene=e,this.mapManager=t,this.houses=i,this.mapData=s,this.houseNames=i.map((e=>e.name)),this.currentHouse=null,this.turnManager=null,this.movementManager=new A(this,t),this.decisionManager=new E(this),this.actionManager=new q(this,this.movementManager)}async notifyTurn(e){this.houseNames.includes(e)&&await this.takeTurn(e)}setTurnManager(e){this.turnManager=e}async takeTurn(e){const t=this.houses.find((t=>t.name===e));if(this.currentHouse=t,this.isEliminated(t))return;let i=0;for(;t.actionPoints>0&&i<10;){this.analyzeMap();const e=await this.decisionManager.makeDecision();if(console.log(e),e)try{await this.actionManager.executeDecision(e),await H(25)}catch(s){i++}else i++}this.endTurn()}async analyzeMap(){this.tilesWithUnits=await this.getTilesWithUnits(),this.castleTiles=await this.getCastleTiles(),this.enemyCastleTiles=await this.getEnemyCastleTiles(),this.outpostTiles=await this.getOutpostTiles()}async getVisibleTiles(){return this.mapData.filter((e=>this.currentHouse.revealedTiles.some((t=>t.q===e.q&&t.r===e.r))))}async getTilesWithUnits(){return(await this.getVisibleTiles()).filter((e=>e.units>0))}async getTilesWithEnemyUnits(){return(await this.getVisibleTiles()).filter((e=>e.units>0&&e.house!==this.currentHouse.name.toLowerCase()))}async getCastleTiles(){return(await this.getVisibleTiles()).filter((e=>"castle"===e.type))}async getEnemyCastleTiles(){return(await this.getCastleTiles()).filter((e=>e.house!==this.currentHouse.name.toLowerCase()))}async getOutpostTiles(){return(await this.getVisibleTiles()).filter((e=>"outpost"===e.type))}getCurrentHouse(){return this.currentHouse}async getThreats(e){return(await this.getNearbyEnemies(e)).filter((t=>t.units>e.units))}async isAdjacent(e,t){const i=Math.abs(e.q-t.q),s=Math.abs(e.r-t.r);return i<=1&&s<=1}async getNearbyEnemies(e){return(await this.getVisibleTiles()).filter((e=>e.units>0&&e.house!==this.currentHouse.name.toLowerCase())).filter((t=>this.isAdjacent(e,t)))}async getWeakestEnemy(e){return(await this.getNearbyEnemies(e)).reduce(((e,t)=>t.units<e.units?t:e),{units:1/0})}async findSafeTile(e){return(await this.getVisibleTiles()).filter((e=>0===e.units)).find((t=>this.isAdjacent(e,t)))}async isNearCastle(e){return(await this.getVisibleTiles()).filter((e=>"castle"===e.type)).some((t=>this.isAdjacent(e,t)))}async isCastleUnderThreat(){const e=await this.getCastleTiles(),t=await this.getTilesWithEnemyUnits();return e.some((e=>t.some((t=>this.isAdjacent(t,e)))))}async getCastleTile(){return(await this.getCastleTiles()).find((e=>e.house===this.currentHouse.name.toLowerCase()))}async getTotalTiles(){return this.mapData.length}async getClosestEnemyCastle(e){const t=await this.getEnemyCastleTiles();console.log(t);let i=null,s=1/0;return t.forEach((t=>{const a=Math.abs(e.q-t.q)+Math.abs(e.r-t.r);a<s&&(s=a,i=t)})),i}async getUnexploredTile(){const e=await this.getVisibleTiles(),t=this.mapData.filter((t=>!e.includes(t)));return t.length>0?t[0]:null}endTurn(){this.currentHouse.resetActionPoints(),this.currentHouse=null}isEliminated(e){return e.units<=0}}function H(e){return new Promise((t=>setTimeout(t,e)))}class N{constructor(e,t,i,s,a,n=null,o=0){this.scene=e,console.log(n,o),this.playerManager=t,this.aiManager=i,this.mapManager=s,this.playerHouse=a;this.turnOrder=n||this.shuffle(["Apollo","Bacchus","Ceres","Diana","Juno","Jupiter","Mars","Mercury","Minerva","Neptune","Pluto","Venus","Vulcan"]),this.currentTurnIndex=o}shuffle(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}async nextTurn(){const e=this.turnOrder[this.currentTurnIndex];console.log("Current house:",e),e===this.playerHouse?(this.scene.updateTurnText("Your turn"),await this.playerManager.notifyTurn(e)):(this.scene.updateTurnText(e+"'s turn"),await this.aiManager.notifyTurn(e)),this.currentTurnIndex=(this.currentTurnIndex+1)%this.turnOrder.length;const t=this.scene.getHouse(e),i=await t.calculateResourceIncome();console.log(i),await this.scene.checkWinLoseConditions()}async startGame(){for(;;)await this.nextTurn()}getTurnOrder(){return this.turnOrder}getCurrentTurnIndex(){return this.currentTurnIndex}}class z{constructor(e,t=50,i={food:0,wood:0,stone:0},s=5,a=[],n=0){this.name=e,this.units=t,this.resources=i,this.actionPoints=s,this.revealedTiles=a,this.turnsHoldingAllCastles=n}addUnits(e){this.units+=e,console.log(this.name+" has "+this.units+" units")}removeUnits(e){this.units=Math.max(0,this.units-e),console.log(this.name+" has "+this.units+" units")}addResources(e,t){this.resources[e]||(this.resources[e]=0),this.resources[e]+=t}removeResources(e,t){this.resources[e]&&(this.resources[e]=Math.max(0,this.resources[e]-t))}calculateResourceIncome(){let e=0,t=0,i=0;return this.revealedTiles.forEach((s=>{s.units>0&&s.house===this.name.toLowerCase()&&(e+=Math.floor(s.food*s.units*.1),t+=Math.floor(s.wood*s.units*.1),i+=Math.floor(s.stone*s.units*.1))})),{food:e,wood:t,stone:i}}resetActionPoints(){this.actionPoints=5}canPerformAction(e){return this.actionPoints>=e}performAction(e){this.actionPoints-=e}getTotalUnits(){return this.units}getTotalCastles(){return this.revealedTiles.filter((e=>e.isCastle&&e.house===this.name.toLowerCase())).length}static instantiateHouses(){return[new z("Apollo"),new z("Bacchus"),new z("Ceres"),new z("Diana"),new z("Juno"),new z("Jupiter"),new z("Mars"),new z("Mercury"),new z("Minerva"),new z("Neptune"),new z("Pluto"),new z("Venus"),new z("Vulcan")]}serialize(){return{name:this.name,units:this.units,resources:this.resources,actionPoints:this.actionPoints,revealedTiles:this.revealedTiles,turnsHoldingAllCastles:this.turnsHoldingAllCastles}}static deserialize(e){return new z(e.name,e.units,e.resources,e.actionPoints,e.revealedTiles,e.turnsHoldingAllCastles)}}class j extends e.Scene{constructor(){super("Institute")}init(){this.tileSize=96,this.sideLength=20,this.margin=100}preload(){const e=this.tileSize-8,t=this.tileSize-16;this.load.svg("grassland","assets/tiles/Grassland.svg",{width:e,height:e}),this.load.svg("mountain","assets/tiles/Mountain.svg",{width:e,height:e}),this.load.svg("hill","assets/tiles/Hill.svg",{width:e,height:e}),this.load.svg("forest","assets/tiles/Forest.svg",{width:e,height:e}),this.load.svg("greatwood","assets/tiles/Greatwood.svg",{width:e,height:e}),this.load.svg("farmland","assets/tiles/Farmland.svg",{width:e,height:e}),this.load.svg("desert","assets/tiles/Desert.svg",{width:e,height:e}),this.load.svg("swamp","assets/tiles/Swamp.svg",{width:e,height:e}),this.load.svg("tundra","assets/tiles/Tundra.svg",{width:e,height:e}),this.load.svg("castle","assets/tiles/Castle.svg",{width:e,height:e}),this.load.svg("shallow","assets/tiles/Shallow.svg",{width:e,height:e}),this.load.svg("deep","assets/tiles/Deep.svg",{width:e,height:e}),this.load.svg("grassland_occupied","assets/tiles/Grassland.svg",{width:t,height:t}),this.load.svg("mountain_occupied","assets/tiles/Mountain.svg",{width:t,height:t}),this.load.svg("hill_occupied","assets/tiles/Hill.svg",{width:t,height:t}),this.load.svg("forest_occupied","assets/tiles/Forest.svg",{width:t,height:t}),this.load.svg("greatwood_occupied","assets/tiles/Greatwood.svg",{width:t,height:t}),this.load.svg("farmland_occupied","assets/tiles/Farmland.svg",{width:t,height:t}),this.load.svg("desert_occupied","assets/tiles/Desert.svg",{width:t,height:t}),this.load.svg("swamp_occupied","assets/tiles/Swamp.svg",{width:t,height:t}),this.load.svg("tundra_occupied","assets/tiles/Tundra.svg",{width:t,height:t}),this.load.svg("castle_occupied","assets/tiles/Castle.svg",{width:t,height:t}),this.load.svg("shallow_occupied","assets/tiles/Shallow.svg",{width:t,height:t}),this.load.svg("deep_occupied","assets/tiles/Deep.svg",{width:t,height:t}),this.load.svg("fog","assets/tiles/Fog.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("eye","assets/icons/eye.svg",{width:32,height:32}),this.load.svg("eye-off","assets/icons/eye-off.svg",{width:32,height:32}),this.load.svg("info","assets/icons/info.svg",{width:32,height:32}),this.load.svg("help","assets/icons/help.svg",{width:32,height:32}),this.load.svg("close","assets/icons/close.svg",{width:32,height:32}),this.load.svg("apollo_border","assets/tiles/ApolloBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("bacchus_border","assets/tiles/BacchusBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("ceres_border","assets/tiles/CeresBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("diana_border","assets/tiles/DianaBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("juno_border","assets/tiles/JunoBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("jupiter_border","assets/tiles/JupiterBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("mars_border","assets/tiles/MarsBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("mercury_border","assets/tiles/MercuryBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("minerva_border","assets/tiles/MinervaBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("neptune_border","assets/tiles/NeptuneBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("pluto_border","assets/tiles/PlutoBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("venus_border","assets/tiles/VenusBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("vulcan_border","assets/tiles/VulcanBorder.svg",{width:this.tileSize,height:this.tileSize}),this.load.svg("normal_border","assets/tiles/NormalBorder.svg",{width:this.tileSize,height:this.tileSize});const i=.55*this.tileSize,s=.55*this.tileSize,a=.4*this.tileSize,n=.4*this.tileSize;this.load.svg("apollo","assets/icons/house/apollo.svg",{width:i,height:s}),this.load.svg("bacchus","assets/icons/house/bacchus.svg",{width:i,height:s}),this.load.svg("ceres","assets/icons/house/ceres.svg",{width:i,height:s}),this.load.svg("diana","assets/icons/house/diana.svg",{width:i,height:s}),this.load.svg("juno","assets/icons/house/juno.svg",{width:i,height:s}),this.load.svg("jupiter","assets/icons/house/jupiter.svg",{width:i,height:s}),this.load.svg("mars","assets/icons/house/mars.svg",{width:i,height:s}),this.load.svg("mercury","assets/icons/house/mercury.svg",{width:i,height:s}),this.load.svg("minerva","assets/icons/house/minerva.svg",{width:i,height:s}),this.load.svg("neptune","assets/icons/house/neptune.svg",{width:i,height:s}),this.load.svg("pluto","assets/icons/house/pluto.svg",{width:i,height:s}),this.load.svg("venus","assets/icons/house/venus.svg",{width:i,height:s}),this.load.svg("vulcan","assets/icons/house/vulcan.svg",{width:i,height:s}),this.load.svg("forest_1","assets/icons/forest/forest_1.svg",{width:i,height:s}),this.load.svg("forest_2","assets/icons/forest/forest_2.svg",{width:i,height:s}),this.load.svg("forest_3","assets/icons/forest/forest_3.svg",{width:i,height:s}),this.load.svg("grassland_1","assets/icons/grassland/grassland_1.svg",{width:i,height:s}),this.load.svg("farmland_1","assets/icons/farmland/farmland_1.svg",{width:i,height:s}),this.load.svg("greatwood_1","assets/icons/greatwood/greatwood_1.svg",{width:i,height:s}),this.load.svg("greatwood_2","assets/icons/greatwood/greatwood_2.svg",{width:i,height:s}),this.load.svg("greatwood_3","assets/icons/greatwood/greatwood_3.svg",{width:i,height:s}),this.load.svg("greatwood_4","assets/icons/greatwood/greatwood_4.svg",{width:i,height:s}),this.load.svg("squiggle_1","assets/icons/squiggle/squiggle_1.svg",{width:i,height:s}),this.load.svg("squiggle_2","assets/icons/squiggle/squiggle_2.svg",{width:i,height:s}),this.load.svg("squiggle_3","assets/icons/squiggle/squiggle_3.svg",{width:i,height:s}),this.load.svg("hill_1","assets/icons/hill/hill_1.svg",{width:i,height:s}),this.load.svg("hill_2","assets/icons/hill/hill_2.svg",{width:i,height:s}),this.load.svg("hill_3","assets/icons/hill/hill_3.svg",{width:i,height:s}),this.load.svg("hill_4","assets/icons/hill/hill_4.svg",{width:i,height:s}),this.load.svg("hill_5","assets/icons/hill/hill_5.svg",{width:i,height:s}),this.load.svg("hill_6","assets/icons/hill/hill_6.svg",{width:i,height:s}),this.load.svg("mountain_1","assets/icons/mountain/mountain_1.svg",{width:i,height:s}),this.load.svg("mountain_2","assets/icons/mountain/mountain_2.svg",{width:i,height:s}),this.load.svg("mountain_3","assets/icons/mountain/mountain_3.svg",{width:i,height:s}),this.load.svg("mountain_4","assets/icons/mountain/mountain_4.svg",{width:i,height:s}),this.load.svg("mountain_5","assets/icons/mountain/mountain_5.svg",{width:i,height:s}),this.load.svg("mountain_6","assets/icons/mountain/mountain_6.svg",{width:i,height:s}),this.load.svg("swamp_1","assets/icons/swamp/swamp_1.svg",{width:i,height:s}),this.load.svg("swamp_2","assets/icons/swamp/swamp_2.svg",{width:i,height:s}),this.load.svg("swamp_3","assets/icons/swamp/swamp_3.svg",{width:i,height:s}),this.load.svg("swamp_4","assets/icons/swamp/swamp_4.svg",{width:i,height:s}),this.load.svg("tundra_1","assets/icons/tundra/tundra_1.svg",{width:i,height:s}),this.load.svg("tundra_2","assets/icons/tundra/tundra_2.svg",{width:i,height:s}),this.load.svg("tundra_3","assets/icons/tundra/tundra_3.svg",{width:i,height:s}),this.load.svg("tundra_4","assets/icons/tundra/tundra_4.svg",{width:i,height:s}),this.load.svg("outpost_1","assets/icons/outpost/outpost_1.svg",{width:i,height:s}),this.load.svg("outpost_2","assets/icons/outpost/outpost_2.svg",{width:i,height:s}),this.load.svg("outpost_3","assets/icons/outpost/outpost_3.svg",{width:i,height:s}),this.load.svg("outpost_4","assets/icons/outpost/outpost_4.svg",{width:i,height:s}),this.load.svg("outpost_5","assets/icons/outpost/outpost_5.svg",{width:i,height:s}),this.load.svg("apollo_small","assets/icons/house/apollo.svg",{width:a,height:n}),this.load.svg("bacchus_small","assets/icons/house/bacchus.svg",{width:a,height:n}),this.load.svg("ceres_small","assets/icons/house/ceres.svg",{width:a,height:n}),this.load.svg("diana_small","assets/icons/house/diana.svg",{width:a,height:n}),this.load.svg("juno_small","assets/icons/house/juno.svg",{width:a,height:n}),this.load.svg("jupiter_small","assets/icons/house/jupiter.svg",{width:a,height:n}),this.load.svg("mars_small","assets/icons/house/mars.svg",{width:a,height:n}),this.load.svg("mercury_small","assets/icons/house/mercury.svg",{width:a,height:n}),this.load.svg("minerva_small","assets/icons/house/minerva.svg",{width:a,height:n}),this.load.svg("neptune_small","assets/icons/house/neptune.svg",{width:a,height:n}),this.load.svg("pluto_small","assets/icons/house/pluto.svg",{width:a,height:n}),this.load.svg("venus_small","assets/icons/house/venus.svg",{width:a,height:n}),this.load.svg("vulcan_small","assets/icons/house/vulcan.svg",{width:a,height:n}),this.load.svg("forest_1_small","assets/icons/forest/forest_1.svg",{width:a,height:n}),this.load.svg("forest_2_small","assets/icons/forest/forest_2.svg",{width:a,height:n}),this.load.svg("forest_3_small","assets/icons/forest/forest_3.svg",{width:a,height:n}),this.load.svg("grassland_1_small","assets/icons/grassland/grassland_1.svg",{width:a,height:n}),this.load.svg("farmland_1_small","assets/icons/farmland/farmland_1.svg",{width:a,height:n}),this.load.svg("greatwood_1_small","assets/icons/greatwood/greatwood_1.svg",{width:a,height:n}),this.load.svg("greatwood_2_small","assets/icons/greatwood/greatwood_2.svg",{width:a,height:n}),this.load.svg("greatwood_3_small","assets/icons/greatwood/greatwood_3.svg",{width:a,height:n}),this.load.svg("greatwood_4_small","assets/icons/greatwood/greatwood_4.svg",{width:a,height:n}),this.load.svg("squiggle_1_small","assets/icons/squiggle/squiggle_1.svg",{width:a,height:n}),this.load.svg("squiggle_2_small","assets/icons/squiggle/squiggle_2.svg",{width:a,height:n}),this.load.svg("squiggle_3_small","assets/icons/squiggle/squiggle_3.svg",{width:a,height:n}),this.load.svg("hill_1_small","assets/icons/hill/hill_1.svg",{width:a,height:n}),this.load.svg("hill_2_small","assets/icons/hill/hill_2.svg",{width:a,height:n}),this.load.svg("hill_3_small","assets/icons/hill/hill_3.svg",{width:a,height:n}),this.load.svg("hill_4_small","assets/icons/hill/hill_4.svg",{width:a,height:n}),this.load.svg("hill_5_small","assets/icons/hill/hill_5.svg",{width:a,height:n}),this.load.svg("hill_6_small","assets/icons/hill/hill_6.svg",{width:a,height:n}),this.load.svg("mountain_1_small","assets/icons/mountain/mountain_1.svg",{width:a,height:n}),this.load.svg("mountain_2_small","assets/icons/mountain/mountain_2.svg",{width:a,height:n}),this.load.svg("mountain_3_small","assets/icons/mountain/mountain_3.svg",{width:a,height:n}),this.load.svg("mountain_4_small","assets/icons/mountain/mountain_4.svg",{width:a,height:n}),this.load.svg("mountain_5_small","assets/icons/mountain/mountain_5.svg",{width:a,height:n}),this.load.svg("mountain_6_small","assets/icons/mountain/mountain_6.svg",{width:a,height:n}),this.load.svg("swamp_1_small","assets/icons/swamp/swamp_1.svg",{width:a,height:n}),this.load.svg("swamp_2_small","assets/icons/swamp/swamp_2.svg",{width:a,height:n}),this.load.svg("swamp_3_small","assets/icons/swamp/swamp_3.svg",{width:a,height:n}),this.load.svg("swamp_4_small","assets/icons/swamp/swamp_4.svg",{width:a,height:n}),this.load.svg("tundra_1_small","assets/icons/tundra/tundra_1.svg",{width:a,height:n}),this.load.svg("tundra_2_small","assets/icons/tundra/tundra_2.svg",{width:a,height:n}),this.load.svg("tundra_3_small","assets/icons/tundra/tundra_3.svg",{width:a,height:n}),this.load.svg("tundra_4_small","assets/icons/tundra/tundra_4.svg",{width:a,height:n}),this.load.svg("outpost_1_small","assets/icons/outpost/outpost_1.svg",{width:a,height:n}),this.load.svg("outpost_2_small","assets/icons/outpost/outpost_2.svg",{width:a,height:n}),this.load.svg("outpost_3_small","assets/icons/outpost/outpost_3.svg",{width:a,height:n}),this.load.svg("outpost_4_small","assets/icons/outpost/outpost_4.svg",{width:a,height:n}),this.load.svg("outpost_5_small","assets/icons/outpost/outpost_5.svg",{width:a,height:n})}async create(){this.cameras.main.setBackgroundColor(0);const e=this.add.image(0,0,"institute").setAlpha(.5);e.setOrigin(0,0),e.setScrollFactor(0),e.setDepth(-1),e.setScale(.75),this.loadProgress(),this.mapManager=new I(this,this.mapData,this.tileSize,this.playerHouse,this.houses),await this.mapManager.revealHouseTiles(this.houses),this.playerManager=new D(this,this.mapManager,this.playerHouse),this.mapManager.setPlayerManager(this.playerManager),this.aiManager=new P(this,this.mapManager,this.aiHouses,this.mapData),this.turnManager=new N(this,this.playerManager,this.aiManager,this.mapManager,this.playerHouse.name,this.turnOrder,this.turnIndex),this.playerManager.setTurnManager(this.turnManager),this.aiManager.setTurnManager(this.turnManager);const t=this.mapData.find((e=>e.icon===this.playerHouse.name.toLowerCase()));let{x:i,y:s}=this.mapManager.getTileCoordinates(t.q,t.r);this.cameraController=new C(this),this.cameraController.initializeCamera(i,s,1),this.cameraController.enablePanning(),this.mapManager.revealAllTiles(this.playerHouse),await this.mapManager.renderMap(this.playerHouse),this.turnManager.startGame()}loadProgress(){const e=localStorage.getItem("gameState");if(this.name=localStorage.getItem("playerName"),this.house=localStorage.getItem("playerHouse"),e){const{mapData:t,houses:i,turnOrder:s,turnIndex:a}=JSON.parse(e);this.mapData=t.map((e=>v.deserialize(e))),this.houses=i.map((e=>z.deserialize(e))),this.turnOrder=s,this.turnIndex=a,this.playerHouse=this.houses.find((e=>e.name.toLowerCase()===this.house)),this.aiHouses=this.houses.filter((e=>e.name.toLowerCase()!==this.house))}else this.mapGenerator=new k(this.tileSize,this.sideLength),this.mapData=this.mapGenerator.generateMapData(),this.houses=z.instantiateHouses(),this.playerHouse=this.houses.find((e=>e.name.toLowerCase()===this.house)),this.aiHouses=this.houses.filter((e=>e.name.toLowerCase()!==this.house))}saveProgress(){const e={mapData:this.mapManager.getMapData(),houses:this.houses,turnOrder:this.turnManager.getTurnOrder(),turnIndex:this.turnManager.getCurrentTurnIndex()};localStorage.setItem("gameState",JSON.stringify(e))}checkWinLoseConditions(){if(0!==this.playerHouse.getTotalUnits())if(this.playerHouse.getTotalUnits()>=650)this.endGame("win","You have eliminated all other houses.");else for(let e of this.houses)if(13===e.getTotalCastles()){if(e.turnsHoldingCastles++,e.turnsHoldingCastles>=5)return void(e===this.playerHouse?this.endGame("win","You have held all 13 castles for 5 turns in a row."):(this.endGame("lose",`House ${e.name} has held all 13 castles for 5 turns in a row.`),this.aiManager.removeHouse(e)))}else e.turnsHoldingCastles=0;else this.endGame("lose","Your house has been eliminated.")}getHouse(e){return this.houses.find((t=>t.name.toLowerCase()===e.toLowerCase()))}endGame(e,t){"win"===e?alert(`Congratulations! You have won the game! Reason: ${t}`):"lose"===e&&alert(`Game Over! You have lost the game. Reason: ${t}`),localStorage.removeItem("gameState"),localStorage.removeItem("playerName"),localStorage.removeItem("playerHouse"),localStorage.setItem("currentScene","CarvingQuestions"),this.scene.start("MainMenu")}displayMessage(e){this.playerManager.overlayManager.displayMessage(e)}updateTurnText(e){this.playerManager.overlayManager.updateTurnText(e)}}const O={type:Phaser.AUTO,width:1024,height:768,parent:"game-container",backgroundColor:"#000000",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[s,u,c,d,m,y,o,j]};new Phaser.Game(O);
